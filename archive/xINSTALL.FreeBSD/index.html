



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="MISP Project - Install Guides">
      
      
        <link rel="canonical" href="https://www.misp-project.org/archive/xINSTALL.FreeBSD/">
      
      
        <meta name="author" content="MISP Project">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.0.1">
    
    
      
        <title>FreeBSD - MISP Install Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.982221ab.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.1f0bcf2b.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#installation-instructions" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://www.misp-project.org/" title="MISP Install Documentation" class="md-header-nav__button md-logo">
          
            <img src="../../img/misp.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              MISP Install Documentation
            </span>
            <span class="md-header-nav__topic">
              FreeBSD
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/MISP/MISP" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    MISP/MISP
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://www.misp-project.org/" title="MISP Install Documentation" class="md-nav__button md-logo">
      
        <img src="../../img/misp.png" width="48" height="48">
      
    </a>
    MISP Install Documentation
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/MISP/MISP" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    MISP/MISP
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Install Guides
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Install Guides
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../INSTALL.ubuntu1804/" title="Ubuntu 18.04" class="md-nav__link">
      Ubuntu 18.04
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../INSTALL.debian9/" title="Debian stable" class="md-nav__link">
      Debian stable
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../INSTALL.kali/" title="Kali Linux" class="md-nav__link">
      Kali Linux
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../INSTALL.rhel7/" title="Redhat Enterprise Linux 7" class="md-nav__link">
      Redhat Enterprise Linux 7
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      xInstall Guides
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        xInstall Guides
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../xINSTALL/" title="Warning" class="md-nav__link">
      Warning
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../xINSTALL.centos6/" title="Centos 6" class="md-nav__link">
      Centos 6
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../xINSTALL.centos7/" title="Centos 7" class="md-nav__link">
      Centos 7
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../xINSTALL.debian_testing/" title="Debian testing" class="md-nav__link">
      Debian testing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../xINSTALL.debian9-postgresql/" title="Debian 9 \w postgresql" class="md-nav__link">
      Debian 9 \w postgresql
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../xINSTALL.ubuntu1804.with.webmin/" title="Ubuntu 18.04 \w webmin" class="md-nav__link">
      Ubuntu 18.04 \w webmin
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../xINSTALL.tsurugi/" title="Tsurugi Linux" class="md-nav__link">
      Tsurugi Linux
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../xINSTALL.OpenBSD/" title="OpenBSD 6.4" class="md-nav__link">
      OpenBSD 6.4
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../xINSTALL.rhel7/" title="Redhat Enterprise Linux 7.6 (BETA)" class="md-nav__link">
      Redhat Enterprise Linux 7.6 (BETA)
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Config Guides
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Config Guides
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../CONFIG.elasticsearch-logging/" title="Elastic Search Logging" class="md-nav__link">
      Elastic Search Logging
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../CONFIG.s3-attachments/" title="Amazon S3 attachments" class="md-nav__link">
      Amazon S3 attachments
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../CONFIG.SMIME/" title="S/MIME" class="md-nav__link">
      S/MIME
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../UPDATE/" title="Update MISP" class="md-nav__link">
      Update MISP
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../UPGRADE/" title="Upgrading MISP" class="md-nav__link">
      Upgrading MISP
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7" checked>
    
    <label class="md-nav__link" for="nav-7">
      Old guides
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Old guides
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../old-2_3to2_4-UPGRADE/" title="2.3 to 2.4 upgrade" class="md-nav__link">
      2.3 to 2.4 upgrade
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../INSTALL.ubuntu1604/" title="Ubuntu 16.04" class="md-nav__link">
      Ubuntu 16.04
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        FreeBSD
      </label>
    
    <a href="./" title="FreeBSD" class="md-nav__link md-nav__link--active">
      FreeBSD
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#for-freebsd-120-amd64" title="for FreeBSD 12.0-amd64" class="md-nav__link">
    for FreeBSD 12.0-amd64
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#0-wip-32you-are-warned-this-does-not-work-yet" title="0/ WIP /! You are warned, this does not work yet! /!\" class="md-nav__link">
    0/ WIP /! You are warned, this does not work yet! /!\
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#misp-configuration-variables" title="MISP configuration variables" class="md-nav__link">
    MISP configuration variables
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-minimal-freebsd-install" title="1/ Minimal FreeBSD install" class="md-nav__link">
    1/ Minimal FreeBSD install
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      About
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        About
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Changelog/" title="MISP Release Notes" class="md-nav__link">
      MISP Release Notes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../license/" title="License" class="md-nav__link">
      License
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#for-freebsd-120-amd64" title="for FreeBSD 12.0-amd64" class="md-nav__link">
    for FreeBSD 12.0-amd64
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#0-wip-32you-are-warned-this-does-not-work-yet" title="0/ WIP /! You are warned, this does not work yet! /!\" class="md-nav__link">
    0/ WIP /! You are warned, this does not work yet! /!\
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#misp-configuration-variables" title="MISP configuration variables" class="md-nav__link">
    MISP configuration variables
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-minimal-freebsd-install" title="1/ Minimal FreeBSD install" class="md-nav__link">
    1/ Minimal FreeBSD install
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="installation-instructions">INSTALLATION INSTRUCTIONS<a class="headerlink" href="#installation-instructions" title="Permanent link">&para;</a></h1>
<h2 id="for-freebsd-120-amd64">for FreeBSD 12.0-amd64<a class="headerlink" href="#for-freebsd-120-amd64" title="Permanent link">&para;</a></h2>
<h3 id="0-wip-32you-are-warned-this-does-not-work-yet">0/ WIP /! You are warned, this does not work yet! /!\<a class="headerlink" href="#0-wip-32you-are-warned-this-does-not-work-yet" title="Permanent link">&para;</a></h3>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>NOT working: pydeep, lief</p>
</div>
<h4 id="misp-configuration-variables">MISP configuration variables<a class="headerlink" href="#misp-configuration-variables" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="c1"># &lt;snippet-begin 0_global-vars.sh&gt;</span>
MISPvars <span class="o">()</span> <span class="o">{</span>
  debug <span class="s2">&quot;Setting generic </span><span class="si">${</span><span class="nv">LBLUE</span><span class="si">}</span><span class="s2">MISP</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2"> variables shared by all flavours&quot;</span>
  <span class="c1"># Local non-root MISP user</span>
  <span class="nv">MISP_USER</span><span class="o">=</span><span class="s1">&#39;misp&#39;</span>
  <span class="nv">MISP_PASSWORD</span><span class="o">=</span><span class="s1">&#39;Password1234&#39;</span>

  <span class="c1"># The web server user</span>
  <span class="nv">WWW_USER</span><span class="o">=</span><span class="s2">&quot;www-data&quot;</span>

  <span class="c1"># MISP configuration variables</span>
  <span class="nv">PATH_TO_MISP</span><span class="o">=</span><span class="s1">&#39;/var/www/MISP&#39;</span>

  <span class="k">if</span> <span class="o">[</span> -z <span class="s2">&quot;</span><span class="nv">$FQDN</span><span class="s2">&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nv">FQDN</span><span class="o">=</span><span class="s2">&quot;misp.local&quot;</span>
  <span class="k">fi</span>

  <span class="k">if</span> <span class="o">[</span> -z <span class="s2">&quot;</span><span class="nv">$MISP_BASEURL</span><span class="s2">&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nv">MISP_BASEURL</span><span class="o">=</span><span class="s1">&#39;&quot;&quot;&#39;</span>
  <span class="k">fi</span>

  <span class="nv">MISP_LIVE</span><span class="o">=</span><span class="s1">&#39;1&#39;</span>

  <span class="c1"># Database configuration</span>
  <span class="nv">DBHOST</span><span class="o">=</span><span class="s1">&#39;localhost&#39;</span>
  <span class="nv">DBNAME</span><span class="o">=</span><span class="s1">&#39;misp&#39;</span>
  <span class="nv">DBUSER_ADMIN</span><span class="o">=</span><span class="s1">&#39;root&#39;</span>
  <span class="nv">DBPASSWORD_ADMIN</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span>openssl rand -hex <span class="m">32</span><span class="k">)</span><span class="s2">&quot;</span>
  <span class="nv">DBUSER_MISP</span><span class="o">=</span><span class="s1">&#39;misp&#39;</span>
  <span class="nv">DBPASSWORD_MISP</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span>openssl rand -hex <span class="m">32</span><span class="k">)</span><span class="s2">&quot;</span>

  <span class="c1"># OpenSSL configuration</span>
  <span class="nv">OPENSSL_CN</span><span class="o">=</span><span class="nv">$FQDN</span>
  <span class="nv">OPENSSL_C</span><span class="o">=</span><span class="s1">&#39;LU&#39;</span>
  <span class="nv">OPENSSL_ST</span><span class="o">=</span><span class="s1">&#39;State&#39;</span>
  <span class="nv">OPENSSL_L</span><span class="o">=</span><span class="s1">&#39;Location&#39;</span>
  <span class="nv">OPENSSL_O</span><span class="o">=</span><span class="s1">&#39;Organization&#39;</span>
  <span class="nv">OPENSSL_OU</span><span class="o">=</span><span class="s1">&#39;Organizational Unit&#39;</span>
  <span class="nv">OPENSSL_EMAILADDRESS</span><span class="o">=</span><span class="s2">&quot;info@</span><span class="nv">$FQDN</span><span class="s2">&quot;</span>

  <span class="c1"># GPG configuration</span>
  <span class="nv">GPG_REAL_NAME</span><span class="o">=</span><span class="s1">&#39;Autogenerated Key&#39;</span>
  <span class="nv">GPG_COMMENT</span><span class="o">=</span><span class="s1">&#39;WARNING: MISP AutoGenerated Key consider this Key VOID!&#39;</span>
  <span class="nv">GPG_EMAIL_ADDRESS</span><span class="o">=</span><span class="s1">&#39;admin@admin.test&#39;</span>
  <span class="nv">GPG_KEY_LENGTH</span><span class="o">=</span><span class="s1">&#39;2048&#39;</span>
  <span class="nv">GPG_PASSPHRASE</span><span class="o">=</span><span class="s1">&#39;Password1234&#39;</span>

  <span class="c1"># debug alias to make sure people are not confused when blindly copy pasting blobs of code</span>
  <span class="nb">alias</span> <span class="nv">debug</span><span class="o">=</span><span class="s2">&quot;echo -e&quot;</span>

  <span class="c1"># checkAptLock alias to make sure people are not confused when blindly copy pasting blobs of code</span>
  <span class="nb">alias</span> <span class="nv">checkAptLock</span><span class="o">=</span><span class="s2">&quot;echo &#39;Function used in Installer to make sure apt is not locked&#39;&quot;</span>

  <span class="c1"># php.ini configuration</span>
  <span class="nv">upload_max_filesize</span><span class="o">=</span>50M
  <span class="nv">post_max_size</span><span class="o">=</span>50M
  <span class="nv">max_execution_time</span><span class="o">=</span><span class="m">300</span>
  <span class="nv">memory_limit</span><span class="o">=</span>512M

  <span class="nv">CAKE</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$PATH_TO_MISP</span><span class="s2">/app/Console/cake&quot;</span>

  <span class="c1"># sudo config to run $LUSER commands</span>
  <span class="nv">SUDO_USER</span><span class="o">=</span><span class="s2">&quot;sudo -H -u </span><span class="si">${</span><span class="nv">MISP_USER</span><span class="si">}</span><span class="s2"> &quot;</span>
  <span class="nv">SUDO_WWW</span><span class="o">=</span><span class="s2">&quot;sudo -H -u </span><span class="si">${</span><span class="nv">WWW_USER</span><span class="si">}</span><span class="s2"> &quot;</span>

  <span class="nb">echo</span> <span class="s2">&quot;The following DB Passwords were generated...&quot;</span>
  <span class="nb">echo</span> <span class="s2">&quot;Admin (</span><span class="si">${</span><span class="nv">DBUSER_ADMIN</span><span class="si">}</span><span class="s2">) DB Password: </span><span class="si">${</span><span class="nv">DBPASSWORD_ADMIN</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="nb">echo</span> <span class="s2">&quot;User  (</span><span class="si">${</span><span class="nv">DBUSER_MISP</span><span class="si">}</span><span class="s2">) DB Password: </span><span class="si">${</span><span class="nv">DBPASSWORD_MISP</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="o">}</span>
<span class="c1"># &lt;snippet-end 0_global-vars.sh&gt;</span>
</pre></div>

<div class="codehilite"><pre><span></span><span class="nv">PHP_ETC_BASE</span><span class="o">=</span>/usr/local/etc
<span class="nv">PHP_INI</span><span class="o">=</span><span class="si">${</span><span class="nv">PHP_ETC_BASE</span><span class="si">}</span>/php.ini
<span class="nv">PATH_TO_MISP</span><span class="o">=</span>/usr/local/www/MISP
<span class="nv">CAKE</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$PATH_TO_MISP</span><span class="s2">/app/Console/cake&quot;</span>
</pre></div>

<h3 id="1-minimal-freebsd-install">1/ Minimal FreeBSD install<a class="headerlink" href="#1-minimal-freebsd-install" title="Permanent link">&para;</a></h3>
<hr />
<h1 id="install-standard-freebsd-amd64-with">Install standard FreeBSD-amd64 with:<a class="headerlink" href="#install-standard-freebsd-amd64-with" title="Permanent link">&para;</a></h1>
<ul>
<li>sshd</li>
<li>ntpdate</li>
<li>ntpd</li>
<li>ports</li>
</ul>
<h1 id="system-hardening">System Hardening<a class="headerlink" href="#system-hardening" title="Permanent link">&para;</a></h1>
<ul>
<li>Clean /tmp</li>
<li>Disable Syslogd network socket</li>
<li>Disable Sendmail service</li>
</ul>
<h1 id="install-pkg-and-point-to-latest">Install pkg and point to latest<a class="headerlink" href="#install-pkg-and-point-to-latest" title="Permanent link">&para;</a></h1>
<div class="codehilite"><pre><span></span>$ su -
<span class="c1"># pkg</span>
</pre></div>

<h4 id="install-sudo">Install sudo<a class="headerlink" href="#install-sudo" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span>pkg install -y sudo
</pre></div>

<div class="admonition notice">
<p class="admonition-title">Notice</p>
<p>Make sure users in group wheel can sudo, uncomment in <strong>/usr/local/etc/sudoers</strong><br />
<div class="codehilite"><pre><span></span>%wheel ALL=(ALL) ALL
</pre></div></p>
</div>
<h4 id="install-bash">Install bash<a class="headerlink" href="#install-bash" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span>sudo pkg install -y bash
</pre></div>

<h4 id="optional-but-useful-add-a-local-misp-user">Optional but useful, add a local misp user<a class="headerlink" href="#optional-but-useful-add-a-local-misp-user" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span>sudo pw user add misp -s /usr/local/bin/bash -G wheel,www,staff
sudo mkdir /home/misp <span class="p">;</span> sudo chown misp:misp /home/misp
sudo passwd misp
</pre></div>

<div class="codehilite"><pre><span></span><span class="c1"># In case you already have a MISP User</span>
sudo pw usermod misp -s /usr/local/bin/bash
sudo pw groupmod -n www -m misp
sudo pw groupmod -n staff -m misp
<span class="nb">exit</span>
</pre></div>

<h4 id="update-system">Update system<a class="headerlink" href="#update-system" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span>sudo freebsd-update fetch install
</pre></div>

<h4 id="fetch-ports-or-update-ports">Fetch ports or update ports<a class="headerlink" href="#fetch-ports-or-update-ports" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span>sudo portsnap fetch extract
<span class="c1"># OR</span>
sudo portsnap fetch update
</pre></div>

<h4 id="make-python3-default-optional">Make python3 default *(optional)<a class="headerlink" href="#make-python3-default-optional" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="nb">echo</span> <span class="s2">&quot;DEFAULT_VERSIONS= python=3.6 python2=2.7 python3=3.6&quot;</span> &gt;&gt; /etc/make.conf
sudo ln -s /usr/local/bin/python3 /usr/local/bin/python
</pre></div>

<h4 id="install-postfix">Install postfix<a class="headerlink" href="#install-postfix" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span>sudo pkg install -y postfix
</pre></div>

<h3 id="famp">FAMP<a class="headerlink" href="#famp" title="Permanent link">&para;</a></h3>
<h4 id="install-misc-dependencies">Install misc dependencies<a class="headerlink" href="#install-misc-dependencies" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span>sudo pkg install -y curl git python3 vim m4 help2man gmake automake libtool expect gsed
</pre></div>

<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>N.B: MariaDB 10.3 currently segfaults on 11.2: <a href="https://bugs.freebsd.org/bugzilla/show_bug.cgi?id=229219">https://bugs.freebsd.org/bugzilla/show_bug.cgi?id=229219</a></p>
</div>
<div class="codehilite"><pre><span></span>sudo pkg install -y apache24 <span class="se">\</span>
    logrotate <span class="se">\</span>
    gnupg <span class="se">\</span>
    mariadb102-server mariadb102-client <span class="se">\</span>
    php72 <span class="se">\</span>
    php72-mysqli <span class="se">\</span>
    php72-xml <span class="se">\</span>
    php72-openssl <span class="se">\</span>
    php72-pcntl <span class="se">\</span>
    php72-mbstring <span class="se">\</span>
    php72-pdo_mysql <span class="se">\</span>
    php72-phar <span class="se">\</span>
    php72-json <span class="se">\</span>
    php72-filter <span class="se">\</span>
    php72-fileinfo <span class="se">\</span>
    php72-dom <span class="se">\</span>
    php72-opcache <span class="se">\</span>
    php72-session <span class="se">\</span>
    mod_php72

sudo cp -p /usr/local/etc/php.ini-development /usr/local/etc/php.ini

sudo sysrc <span class="nv">apache24_enable</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span>
sudo sysrc <span class="nv">mysql_enable</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span>
sudo sysrc <span class="nv">mysql_args</span><span class="o">=</span><span class="s2">&quot;--bind-address=127.0.0.1&quot;</span>
sudo service apache24 start
sudo service mysql-server start


<span class="c1">### /!\ Needs Fixing /!\</span>
<span class="c1"># Add your credentials if needed, if sudo has NOPASS, comment out the relevant lines</span>
<span class="nv">pw</span><span class="o">=</span><span class="s2">&quot;Password1234&quot;</span>

expect -f - <span class="s">&lt;&lt;-EOF</span>
<span class="s">  set timeout 10</span>

<span class="s">  spawn sudo mysql_secure_installation</span>
<span class="s">  expect &quot;*?assword*&quot;</span>
<span class="s">  send -- &quot;$pw\r&quot;</span>
<span class="s">  expect &quot;Enter current password for root (enter for none):&quot;</span>
<span class="s">  send -- &quot;\r&quot;</span>
<span class="s">  expect &quot;Set root password?&quot;</span>
<span class="s">  send -- &quot;y\r&quot;</span>
<span class="s">  expect &quot;New password:&quot;</span>
<span class="s">  send -- &quot;${DBPASSWORD_ADMIN}\r&quot;</span>
<span class="s">  expect &quot;Re-enter new password:&quot;</span>
<span class="s">  send -- &quot;${DBPASSWORD_ADMIN}\r&quot;</span>
<span class="s">  expect &quot;Remove anonymous users?&quot;</span>
<span class="s">  send -- &quot;y\r&quot;</span>
<span class="s">  expect &quot;Disallow root login remotely?&quot;</span>
<span class="s">  send -- &quot;y\r&quot;</span>
<span class="s">  expect &quot;Remove test database and access to it?&quot;</span>
<span class="s">  send -- &quot;y\r&quot;</span>
<span class="s">  expect &quot;Reload privilege tables now?&quot;</span>
<span class="s">  send -- &quot;y\r&quot;</span>
<span class="s">  expect eof</span>
<span class="s">EOF</span>

sudo pkg remove -R tcl86

<span class="nb">echo</span> <span class="s2">&quot;&lt;IfModule dir_module&gt;</span>
<span class="s2">    DirectoryIndex index.php index.html</span>

<span class="s2">    &lt;FilesMatch &quot;</span><span class="se">\.</span>php<span class="s2">$&quot;&gt;</span>
<span class="s2">        SetHandler application/x-httpd-php</span>
<span class="s2">    &lt;/FilesMatch&gt;</span>

<span class="s2">    &lt;FilesMatch &quot;</span><span class="se">\.</span>phps<span class="s2">$&quot;&gt;</span>
<span class="s2">        SetHandler application/x-httpd-php-source</span>
<span class="s2">    &lt;/FilesMatch&gt;</span>
<span class="s2">&lt;/IfModule&gt;&quot;</span> <span class="p">|</span>sudo tee -a /usr/local/etc/apache24/Includes/php.conf
</pre></div>

<h4 id="redis-needs-to-be-installed-via-ports">Redis needs to be installed via ports<a class="headerlink" href="#redis-needs-to-be-installed-via-ports" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span>cd /usr/ports/databases/redis
sudo make install clean
sudo sysrc redis_enable=&quot;yes&quot;
</pre></div>

<h5 id="php-redis">php-redis<a class="headerlink" href="#php-redis" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span>cd /usr/ports/databases/pecl-redis
sudo make install clean
</pre></div>

<h5 id="php-gnupg">php-gnupg<a class="headerlink" href="#php-gnupg" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span>cd /usr/ports/security/pecl-gnupg
sudo make install clean
</pre></div>

<h4 id="php-cli-tweak">PHP CLI Tweak<a class="headerlink" href="#php-cli-tweak" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="nb">echo</span> <span class="s2">&quot;PATH=</span><span class="nv">$PATH</span><span class="s2">:/usr/local/bin&quot;</span> <span class="p">|</span>sudo tee -a /usr/local/etc/apache24/envvars.d/php.env

sudo service apache24 restart
</pre></div>

<h3 id="3-misp-code">3/ MISP code<a class="headerlink" href="#3-misp-code" title="Permanent link">&para;</a></h3>
<hr />
<div class="codehilite"><pre><span></span><span class="c1"># Download MISP using git in the /usr/local/www/ directory.</span>
sudo mkdir <span class="si">${</span><span class="nv">PATH_TO_MISP</span><span class="si">}</span>
sudo chown www:www <span class="si">${</span><span class="nv">PATH_TO_MISP</span><span class="si">}</span>
<span class="nb">cd</span> <span class="si">${</span><span class="nv">PATH_TO_MISP</span><span class="si">}</span>
sudo -u www git clone https://github.com/MISP/MISP.git <span class="si">${</span><span class="nv">PATH_TO_MISP</span><span class="si">}</span>

<span class="c1"># Make git ignore filesystem permission differences</span>
sudo -u www git config core.filemode <span class="nb">false</span>

sudo -u www git submodule update --init --recursive
<span class="c1"># Make git ignore filesystem permission differences for submodules</span>
sudo -u www git submodule foreach --recursive git config core.filemode <span class="nb">false</span>

<span class="c1"># install Mitre&#39;s STIX and its dependencies by running the following commands:</span>
sudo pkg install -y py36-pip libxml2 libxslt

<span class="c1"># Install virtualenv</span>
sudo pip-3.6 install virtualenv

<span class="c1"># Create a python3 virtualenv</span>
sudo -u www virtualenv -p python3 <span class="si">${</span><span class="nv">PATH_TO_MISP</span><span class="si">}</span>/venv

<span class="nb">cd</span> <span class="si">${</span><span class="nv">PATH_TO_MISP</span><span class="si">}</span>/app/files/scripts
sudo -u www git clone https://github.com/CybOXProject/python-cybox.git
sudo -u www git clone https://github.com/STIXProject/python-stix.git
sudo -u www git clone https://github.com/MAECProject/python-maec.git
<span class="c1"># install mixbox to accommodate the new STIX dependencies:</span>
sudo -u www git clone https://github.com/CybOXProject/mixbox.git
<span class="nb">cd</span> <span class="si">${</span><span class="nv">PATH_TO_MISP</span><span class="si">}</span>/app/files/scripts/mixbox
sudo -H -u www <span class="si">${</span><span class="nv">PATH_TO_MISP</span><span class="si">}</span>/venv/bin/pip install .
<span class="nb">cd</span> <span class="si">${</span><span class="nv">PATH_TO_MISP</span><span class="si">}</span>/app/files/scripts/python-cybox
sudo -H -u www <span class="si">${</span><span class="nv">PATH_TO_MISP</span><span class="si">}</span>/venv/bin/pip install .
<span class="nb">cd</span> <span class="si">${</span><span class="nv">PATH_TO_MISP</span><span class="si">}</span>/app/files/scripts/python-stix
sudo -H -u www <span class="si">${</span><span class="nv">PATH_TO_MISP</span><span class="si">}</span>/venv/bin/pip install .

<span class="c1"># install PyMISP</span>
<span class="nb">cd</span> <span class="si">${</span><span class="nv">PATH_TO_MISP</span><span class="si">}</span>/PyMISP
sudo -H -u www <span class="si">${</span><span class="nv">PATH_TO_MISP</span><span class="si">}</span>/venv/bin/pip install .
</pre></div>

<h3 id="4-cakephp">4/ CakePHP<a class="headerlink" href="#4-cakephp" title="Permanent link">&para;</a></h3>
<hr />
<div class="codehilite"><pre><span></span><span class="c1"># Install CakeResque along with its dependencies if you intend to use the built in background jobs:</span>
<span class="nb">cd</span> <span class="si">${</span><span class="nv">PATH_TO_MISP</span><span class="si">}</span>/app
sudo -u www php composer.phar require kamisama/cake-resque:4.1.2
sudo -u www php composer.phar config vendor-dir Vendor
sudo -u www php composer.phar install

<span class="c1"># To use the scheduler worker for scheduled tasks, do the following:</span>
sudo -u www cp -fa /usr/local/www/MISP/INSTALL/setup/config.php /usr/local/www/MISP/app/Plugin/CakeResque/Config/config.php
</pre></div>

<h3 id="5-set-the-permissions">5/ Set the permissions<a class="headerlink" href="#5-set-the-permissions" title="Permanent link">&para;</a></h3>
<hr />
<div class="codehilite"><pre><span></span># Check if the permissions are set correctly using the following commands:
sudo chown -R www:www /usr/local/www/MISP
sudo chmod -R 750 /usr/local/www/MISP
sudo chmod -R g+ws /usr/local/www/MISP/app/tmp
sudo chmod -R g+ws /usr/local/www/MISP/app/files
sudo chmod -R g+ws /usr/local/www/MISP/app/files/scripts/tmp
</pre></div>

<h3 id="6-create-a-database-and-user">6/ Create a database and user<a class="headerlink" href="#6-create-a-database-and-user" title="Permanent link">&para;</a></h3>
<hr />
<div class="codehilite"><pre><span></span># Enter the mysql shell
sudo mysql -u root -p

MariaDB [(none)]&gt; create database misp;
MariaDB [(none)]&gt; grant usage on *.* to misp@localhost identified by &#39;XXXXdbpasswordhereXXXXX&#39;;
MariaDB [(none)]&gt; grant all privileges on misp.* to misp@localhost;
MariaDB [(none)]&gt; flush privileges;
MariaDB [(none)]&gt; exit
</pre></div>

<h4 id="copypaste">copy/paste<a class="headerlink" href="#copypaste" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span>sudo mysql -u $DBUSER_ADMIN -p$DBPASSWORD_ADMIN -e &quot;create database $DBNAME;&quot;
sudo mysql -u $DBUSER_ADMIN -p$DBPASSWORD_ADMIN -e &quot;grant usage on *.* to $DBNAME@localhost identified by &#39;$DBPASSWORD_MISP&#39;;&quot;
sudo mysql -u $DBUSER_ADMIN -p$DBPASSWORD_ADMIN -e &quot;grant all privileges on $DBNAME.* to &#39;$DBUSER_MISP&#39;@&#39;localhost&#39;;&quot;
sudo mysql -u $DBUSER_ADMIN -p$DBPASSWORD_ADMIN -e &quot;flush privileges;&quot;
</pre></div>

<div class="codehilite"><pre><span></span><span class="c1"># Import the empty MISP database from MYSQL.sql</span>
sudo -u www cat <span class="nv">$PATH_TO_MISP</span>/INSTALL/MYSQL.sql <span class="p">|</span> mysql -u <span class="nv">$DBUSER_MISP</span> -p<span class="nv">$DBPASSWORD_MISP</span> <span class="nv">$DBNAME</span>
</pre></div>

<h3 id="7-apache-configuration">7/ Apache configuration<a class="headerlink" href="#7-apache-configuration" title="Permanent link">&para;</a></h3>
<hr />
<div class="codehilite"><pre><span></span><span class="c1"># Now configure your Apache webserver with the DocumentRoot /usr/local/www/MISP/app/webroot/</span>

<span class="c1">#2.4</span>
sudo mkdir /usr/local/etc/apache24/sites-available/ /usr/local/etc/apache24/sites-enabled/

<span class="c1"># If the apache version is 2.4:</span>
sudo cp /usr/local/www/MISP/INSTALL/apache.24.misp.ssl /usr/local/etc/apache24/sites-available/misp-ssl.conf

<span class="c1"># Be aware that the configuration files for apache 2.4 and up have changed.</span>
<span class="c1"># The configuration file has to have the .conf extension in the sites-available directory</span>
<span class="c1"># For more information, visit http://httpd.apache.org/docs/2.4/upgrading.html</span>

sudo mkdir /etc/ssl/private/
<span class="c1"># If a valid SSL certificate is not already created for the server, create a self-signed certificate: (Make sure to fill the &lt;â€¦&gt;)</span>
sudo openssl req -newkey rsa:4096 -days <span class="m">365</span> -nodes -x509 <span class="se">\</span>
-subj <span class="s2">&quot;/C=</span><span class="si">${</span><span class="nv">OPENSSL_C</span><span class="si">}</span><span class="s2">/ST=</span><span class="si">${</span><span class="nv">OPENSSL_ST</span><span class="si">}</span><span class="s2">/L=</span><span class="si">${</span><span class="nv">OPENSSL_L</span><span class="si">}</span><span class="s2">/O=</span><span class="si">${</span><span class="nv">OPENSSL_O</span><span class="si">}</span><span class="s2">/OU=</span><span class="si">${</span><span class="nv">OPENSSL_OU</span><span class="si">}</span><span class="s2">/CN=</span><span class="si">${</span><span class="nv">OPENSSL_CN</span><span class="si">}</span><span class="s2">/emailAddress=</span><span class="si">${</span><span class="nv">OPENSSL_EMAILADDRESS</span><span class="si">}</span><span class="s2">&quot;</span> <span class="se">\</span>
-keyout /etc/ssl/private/misp.local.key -out /etc/ssl/private/misp.local.crt

sudo chmod <span class="m">750</span> /etc/ssl/private/
sudo chmod <span class="m">640</span> /etc/ssl/private/*

<span class="c1"># Otherwise, copy the SSLCertificateFile, SSLCertificateKeyFile, and SSLCertificateChainFile to /etc/ssl/private/. (Modify path and config to fit your environment)</span>

sudo mkdir /var/log/apache24/

sudo gsed -i <span class="s2">&quot;s/apache2/apache24/&quot;</span> /usr/local/etc/apache24/sites-available/misp-ssl.conf
sudo gsed -i <span class="s2">&quot;s/var\/www/usr\/local\/www/&quot;</span> /usr/local/etc/apache24/sites-available/misp-ssl.conf
sudo gsed -i <span class="s2">&quot;s/SSLCertificateChainFile/#SSLCertificateChainFile/&quot;</span> /usr/local/etc/apache24/sites-available/misp-ssl.conf

<span class="c1"># activate new vhost</span>
<span class="nb">cd</span> /usr/local/etc/apache24/sites-enabled/
sudo ln -s ../sites-available/misp-ssl.conf
<span class="nb">echo</span> <span class="s2">&quot;Include etc/apache24/sites-enabled/*.conf&quot;</span> <span class="p">|</span>sudo tee -a /usr/local/etc/apache24/httpd.conf
<span class="nb">echo</span> <span class="s2">&quot;IncludeOptional etc/apache24/sites-enabled/*.conf&quot;</span> <span class="p">|</span>sudo tee -a /usr/local/etc/apache24/httpd.conf

<span class="k">for</span> key in upload_max_filesize post_max_size max_execution_time max_input_time memory_limit
<span class="k">do</span>
    sudo gsed -i <span class="s2">&quot;s/^\(</span><span class="nv">$key</span><span class="s2">\).*/\1 = </span><span class="k">$(</span><span class="nb">eval</span> <span class="nb">echo</span> <span class="se">\$</span><span class="o">{</span><span class="nv">$key</span><span class="o">}</span><span class="k">)</span><span class="s2">/&quot;</span> <span class="nv">$PHP_INI</span>
<span class="k">done</span>

sudo gsed -i <span class="s2">&quot;s/#LoadModule rewrite_module libexec\/apache24\/mod_rewrite.so/LoadModule rewrite_module libexec\/apache24\/mod_rewrite.so/&quot;</span> /usr/local/etc/apache24/httpd.conf
sudo gsed -i <span class="s2">&quot;s/#LoadModule ssl_module libexec\/apache24\/mod_ssl.so/LoadModule ssl_module libexec\/apache24\/mod_ssl.so/&quot;</span> /usr/local/etc/apache24/httpd.conf
sudo gsed -i <span class="s2">&quot;s/Listen 80/Listen 80\nListen 443/&quot;</span> /usr/local/etc/apache24/httpd.conf

<span class="c1"># Restart apache</span>
sudo service apache24 restart
</pre></div>

<h3 id="8-log-rotation">8/ Log rotation<a class="headerlink" href="#8-log-rotation" title="Permanent link">&para;</a></h3>
<hr />
<div class="codehilite"><pre><span></span><span class="c1"># MISP saves the stdout and stderr of its workers in /usr/local/www/MISP/app/tmp/logs</span>
<span class="c1"># To rotate these logs install the supplied logrotate script:</span>
sudo cp /usr/local/www/MISP/INSTALL/misp.logrotate /usr/local/etc/logrotate.d/misp
sudo chmod <span class="m">0640</span> /usr/local/etc/logrotate.d/misp
</pre></div>

<h3 id="9-misp-configuration">9/ MISP configuration<a class="headerlink" href="#9-misp-configuration" title="Permanent link">&para;</a></h3>
<hr />
<div class="codehilite"><pre><span></span><span class="c1"># There are 4 sample configuration files in /usr/local/www/MISP/app/Config that need to be copied</span>
sudo -u www cp -a /usr/local/www/MISP/app/Config/bootstrap.default.php /usr/local/www/MISP/app/Config/bootstrap.php
sudo -u www cp -a /usr/local/www/MISP/app/Config/database.default.php /usr/local/www/MISP/app/Config/database.php
sudo -u www cp -a /usr/local/www/MISP/app/Config/core.default.php /usr/local/www/MISP/app/Config/core.php
sudo -u www cp -a /usr/local/www/MISP/app/Config/config.default.php /usr/local/www/MISP/app/Config/config.php

<span class="c1"># Configure the fields in the newly created files:</span>


<span class="nb">echo</span> <span class="s2">&quot;&lt;?php</span>
<span class="s2">class DATABASE_CONFIG {</span>
<span class="s2">        public \$default = array(</span>
<span class="s2">                &#39;datasource&#39; =&gt; &#39;Database/Mysql&#39;,</span>
<span class="s2">                //&#39;datasource&#39; =&gt; &#39;Database/Postgres&#39;,</span>
<span class="s2">                &#39;persistent&#39; =&gt; false,</span>
<span class="s2">                &#39;host&#39; =&gt; &#39;</span><span class="nv">$DBHOST</span><span class="s2">&#39;,</span>
<span class="s2">                &#39;login&#39; =&gt; &#39;</span><span class="nv">$DBUSER_MISP</span><span class="s2">&#39;,</span>
<span class="s2">                &#39;port&#39; =&gt; 3306, // MySQL &amp; MariaDB</span>
<span class="s2">                //&#39;port&#39; =&gt; 5432, // PostgreSQL</span>
<span class="s2">                &#39;password&#39; =&gt; &#39;</span><span class="nv">$DBPASSWORD_MISP</span><span class="s2">&#39;,</span>
<span class="s2">                &#39;database&#39; =&gt; &#39;</span><span class="nv">$DBNAME</span><span class="s2">&#39;,</span>
<span class="s2">                &#39;prefix&#39; =&gt; &#39;&#39;,</span>
<span class="s2">                &#39;encoding&#39; =&gt; &#39;utf8&#39;,</span>
<span class="s2">        );</span>
<span class="s2">}&quot;</span> <span class="p">|</span> sudo -u www tee <span class="nv">$PATH_TO_MISP</span>/app/Config/database.php

<span class="c1"># Important! Change the salt key in /usr/local/www/MISP/app/Config/config.php</span>
<span class="c1"># The salt key must be a string at least 32 bytes long.</span>
<span class="c1"># The admin user account will be generated on the first login, make sure that the salt is changed before you create that user</span>
<span class="c1"># If you forget to do this step, and you are still dealing with a fresh installation, just alter the salt,</span>
<span class="c1"># delete the user from mysql and log in again using the default admin credentials (admin@admin.test / admin)</span>

<span class="c1"># Change base url in config.php</span>
<span class="c1"># example: &#39;baseurl&#39; =&gt; &#39;https://&lt;your.FQDN.here&gt;&#39;,</span>
<span class="c1"># alternatively, you can leave this field empty if you would like to use relative pathing in MISP</span>
<span class="c1"># &#39;baseurl&#39; =&gt; &#39;&#39;,</span>

<span class="c1"># and make sure the file permissions are still OK</span>
sudo chown -R www:www /usr/local/www/MISP/app/Config
sudo chmod -R <span class="m">750</span> /usr/local/www/MISP/app/Config

<span class="c1"># Generate a GPG encryption key.</span>

cat &gt;/tmp/gen-key-script <span class="s">&lt;&lt;EOF</span>
<span class="s">    %echo Generating a default key</span>
<span class="s">    Key-Type: default</span>
<span class="s">    Key-Length: $GPG_KEY_LENGTH</span>
<span class="s">    Subkey-Type: default</span>
<span class="s">    Name-Real: $GPG_REAL_NAME</span>
<span class="s">    Name-Comment: $GPG_COMMENT</span>
<span class="s">    Name-Email: $GPG_EMAIL_ADDRESS</span>
<span class="s">    Expire-Date: 0</span>
<span class="s">    Passphrase: $GPG_PASSPHRASE</span>
<span class="s">    # Do a commit here, so that we can later print &quot;done&quot;</span>
<span class="s">    %commit</span>
<span class="s">    %echo done</span>
<span class="s">EOF</span>

sudo -u www gpg --homedir <span class="nv">$PATH_TO_MISP</span>/.gnupg --batch --gen-key /tmp/gen-key-script
<span class="c1"># The email address should match the one set in the config.php / set in the configuration menu in the administration menu configuration file</span>

<span class="c1"># And export the public key to the webroot</span>
sudo -u www sh -c <span class="s2">&quot;gpg --homedir </span><span class="nv">$PATH_TO_MISP</span><span class="s2">/.gnupg --export --armor </span><span class="nv">$GPG_EMAIL_ADDRESS</span><span class="s2">&quot;</span> <span class="p">|</span> sudo -u www tee <span class="nv">$PATH_TO_MISP</span>/app/webroot/gpg.asc

<span class="c1"># To make the background workers start on boot</span>
sudo chmod +x /usr/local/www/MISP/app/Console/worker/start.sh

<span class="k">if</span> <span class="o">[</span> ! -e /etc/rc.local <span class="o">]</span>
<span class="k">then</span>
    <span class="nb">echo</span> <span class="s1">&#39;#!/bin/sh -e&#39;</span> <span class="p">|</span> sudo tee -a /etc/rc.local
    <span class="nb">echo</span> <span class="s1">&#39;exit 0&#39;</span> <span class="p">|</span> sudo tee -a /etc/rc.local
    sudo chmod u+x /etc/rc.local
<span class="k">fi</span>
</pre></div>

<h4 id="initialize-misp-configuration-and-set-some-defaults">Initialize MISP configuration and set some defaults<a class="headerlink" href="#initialize-misp-configuration-and-set-some-defaults" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="c1"># &lt;snippet-begin 2_core-cake.sh&gt;</span>
<span class="c1"># Core cake commands</span>
coreCAKE <span class="o">()</span> <span class="o">{</span>
  debug <span class="s2">&quot;Running core Cake commands to set sane defaults for </span><span class="si">${</span><span class="nv">LBLUE</span><span class="si">}</span><span class="s2">MISP</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="nv">$SUDO_WWW</span> -E <span class="nv">$CAKE</span> userInit -q

  <span class="c1"># This makes sure all Database upgrades are done, without logging in.</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin updateDatabase

  <span class="c1"># Setup some more MISP default via cake CLI</span>

  <span class="c1"># The default install is Python in a virtualenv, setting accordingly</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.python_bin&quot;</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">PATH_TO_MISP</span><span class="si">}</span><span class="s2">/venv/bin/python&quot;</span>

  <span class="c1"># Tune global time outs</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Session.autoRegenerate&quot;</span> <span class="m">0</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Session.timeout&quot;</span> <span class="m">600</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Session.cookieTimeout&quot;</span> <span class="m">3600</span>

  <span class="c1"># Change base url, either with this CLI command or in the UI</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Baseurl <span class="nv">$MISP_BASEURL</span>
  <span class="c1"># example: &#39;baseurl&#39; =&gt; &#39;https://&lt;your.FQDN.here&gt;&#39;,</span>
  <span class="c1"># alternatively, you can leave this field empty if you would like to use relative pathing in MISP</span>
  <span class="c1"># &#39;baseurl&#39; =&gt; &#39;&#39;,</span>

  <span class="c1"># Enable GnuPG</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;GnuPG.email&quot;</span> <span class="s2">&quot;</span><span class="nv">$GPG_EMAIL_ADDRESS</span><span class="s2">&quot;</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;GnuPG.homedir&quot;</span> <span class="s2">&quot;</span><span class="nv">$PATH_TO_MISP</span><span class="s2">/.gnupg&quot;</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;GnuPG.password&quot;</span> <span class="s2">&quot;</span><span class="nv">$GPG_PASSPHRASE</span><span class="s2">&quot;</span>

  <span class="c1"># Enable installer org and tune some configurables</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.host_org_id&quot;</span> <span class="m">1</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.email&quot;</span> <span class="s2">&quot;info@admin.test&quot;</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.disable_emailing&quot;</span> <span class="nb">true</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.contact&quot;</span> <span class="s2">&quot;info@admin.test&quot;</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.disablerestalert&quot;</span> <span class="nb">true</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.showCorrelationsOnIndex&quot;</span> <span class="nb">true</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.default_event_tag_collection&quot;</span> <span class="m">0</span>

  <span class="c1"># Provisional Cortex tunes</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.Cortex_services_enable&quot;</span> <span class="nb">false</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.Cortex_services_url&quot;</span> <span class="s2">&quot;http://127.0.0.1&quot;</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.Cortex_services_port&quot;</span> <span class="m">9000</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.Cortex_timeout&quot;</span> <span class="m">120</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.Cortex_authkey&quot;</span> <span class="s2">&quot;&quot;</span>
  <span class="c1"># Mysteriously removed?</span>
  <span class="c1">#$SUDO_WWW $CAKE Admin setSetting &quot;Plugin.Cortex_services_timeout&quot; 120</span>
  <span class="c1"># Mysteriously removed?</span>
  <span class="c1">#$SUDO_WWW $CAKE Admin setSetting &quot;Plugin.Cortex_services_authkey&quot; &quot;&quot;</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.Cortex_ssl_verify_peer&quot;</span> <span class="nb">false</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.Cortex_ssl_verify_host&quot;</span> <span class="nb">false</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.Cortex_ssl_allow_self_signed&quot;</span> <span class="nb">true</span>

  <span class="c1"># Various plugin sightings settings</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.Sightings_policy&quot;</span> <span class="m">0</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.Sightings_anonymise&quot;</span> <span class="nb">false</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.Sightings_range&quot;</span> <span class="m">365</span>

  <span class="c1"># Plugin CustomAuth tuneable</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.CustomAuth_disable_logout&quot;</span> <span class="nb">false</span>

  <span class="c1"># RPZ Plugin settings</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.RPZ_policy&quot;</span> <span class="s2">&quot;DROP&quot;</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.RPZ_walled_garden&quot;</span> <span class="s2">&quot;127.0.0.1&quot;</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.RPZ_serial&quot;</span> <span class="s2">&quot;\$date00&quot;</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.RPZ_refresh&quot;</span> <span class="s2">&quot;2h&quot;</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.RPZ_retry&quot;</span> <span class="s2">&quot;30m&quot;</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.RPZ_expiry&quot;</span> <span class="s2">&quot;30d&quot;</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.RPZ_minimum_ttl&quot;</span> <span class="s2">&quot;1h&quot;</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.RPZ_ttl&quot;</span> <span class="s2">&quot;1w&quot;</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.RPZ_ns&quot;</span> <span class="s2">&quot;localhost.&quot;</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.RPZ_ns_alt&quot;</span> <span class="s2">&quot;&quot;</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.RPZ_email&quot;</span> <span class="s2">&quot;root.localhost&quot;</span>

  <span class="c1"># Force defaults to make MISP Server Settings less RED</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.language&quot;</span> <span class="s2">&quot;eng&quot;</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.proposals_block_attributes&quot;</span> <span class="nb">false</span>

  <span class="c1"># Redis block</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.redis_host&quot;</span> <span class="s2">&quot;127.0.0.1&quot;</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.redis_port&quot;</span> <span class="m">6379</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.redis_database&quot;</span> <span class="m">13</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.redis_password&quot;</span> <span class="s2">&quot;&quot;</span>

  <span class="c1"># Force defaults to make MISP Server Settings less YELLOW</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.ssdeep_correlation_threshold&quot;</span> <span class="m">40</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.extended_alert_subject&quot;</span> <span class="nb">false</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.default_event_threat_level&quot;</span> <span class="m">4</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.newUserText&quot;</span> <span class="s2">&quot;Dear new MISP user,\\n\\nWe would hereby like to welcome you to the \$org MISP community.\\n\\n Use the credentials below to log into MISP at \$misp, where you will be prompted to manually change your password to something of your own choice.\\n\\nUsername: \$username\\nPassword: \$password\\n\\nIf you have any questions, don&#39;t hesitate to contact us at: \$contact.\\n\\nBest regards,\\nYour \$org MISP support team&quot;</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.passwordResetText&quot;</span> <span class="s2">&quot;Dear MISP user,\\n\\nA password reset has been triggered for your account. Use the below provided temporary password to log into MISP at \$misp, where you will be prompted to manually change your password to something of your own choice.\\n\\nUsername: \$username\\nYour temporary password: \$password\\n\\nIf you have any questions, don&#39;t hesitate to contact us at: \$contact.\\n\\nBest regards,\\nYour \$org MISP support team&quot;</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.enableEventBlacklisting&quot;</span> <span class="nb">true</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.enableOrgBlacklisting&quot;</span> <span class="nb">true</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.log_client_ip&quot;</span> <span class="nb">false</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.log_auth&quot;</span> <span class="nb">false</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.disableUserSelfManagement&quot;</span> <span class="nb">false</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.block_event_alert&quot;</span> <span class="nb">false</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.block_event_alert_tag&quot;</span> <span class="s2">&quot;no-alerts=\&quot;true\&quot;&quot;</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.block_old_event_alert&quot;</span> <span class="nb">false</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.block_old_event_alert_age&quot;</span> <span class="s2">&quot;&quot;</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.incoming_tags_disabled_by_default&quot;</span> <span class="nb">false</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.footermidleft&quot;</span> <span class="s2">&quot;This is an initial install&quot;</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.footermidright&quot;</span> <span class="s2">&quot;Please configure and harden accordingly&quot;</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.welcome_text_top&quot;</span> <span class="s2">&quot;Initial Install, please configure&quot;</span>
  <span class="c1"># TODO: Make sure $FLAVOUR is correct</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.welcome_text_bottom&quot;</span> <span class="s2">&quot;Welcome to MISP on </span><span class="nv">$FLAVOUR</span><span class="s2">, change this message in MISP Settings&quot;</span>

  <span class="c1"># Force defaults to make MISP Server Settings less GREEN</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Security.password_policy_length&quot;</span> <span class="m">12</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Security.password_policy_complexity&quot;</span> <span class="s1">&#39;/^((?=.*\d)|(?=.*\W+))(?![\n])(?=.*[A-Z])(?=.*[a-z]).*$|.{16,}/&#39;</span>

  <span class="c1"># Set MISP Live</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Live <span class="nv">$MISP_LIVE</span>
<span class="o">}</span>

<span class="c1"># This updates Galaxies, ObjectTemplates, Warninglists, Noticelists, Templates</span>
updateGOWNT <span class="o">()</span> <span class="o">{</span>
  debug <span class="s2">&quot;Updating Galaxies, ObjectTemplates, Warninglists, Noticelists and Templates&quot;</span>
  <span class="nv">AUTH_KEY</span><span class="o">=</span><span class="k">$(</span>mysql -u <span class="nv">$DBUSER_MISP</span> -p<span class="nv">$DBPASSWORD_MISP</span> misp -e <span class="s2">&quot;SELECT authkey FROM users;&quot;</span> <span class="p">|</span> tail -1<span class="k">)</span>

  <span class="c1"># Update the galaxiesâ€¦</span>
  <span class="c1"># TODO: Fix updateGalaxies</span>
  <span class="c1">##$SUDO_WWW $CAKE Admin updateGalaxies</span>
  curl --header <span class="s2">&quot;Authorization: </span><span class="nv">$AUTH_KEY</span><span class="s2">&quot;</span> --header <span class="s2">&quot;Accept: application/json&quot;</span> --header <span class="s2">&quot;Content-Type: application/json&quot;</span> -k -X POST https://127.0.0.1/galaxies/update
  <span class="c1"># Updating the taxonomiesâ€¦</span>
  <span class="nv">$SUDO_WWW</span> <span class="nv">$CAKE</span> Admin updateTaxonomies
  <span class="c1"># Updating the warning listsâ€¦</span>
  <span class="c1"># TODO: Fix updateWarningLists</span>
  <span class="c1">##$SUDO_WWW $CAKE Admin updateWarningLists</span>
  curl --header <span class="s2">&quot;Authorization: </span><span class="nv">$AUTH_KEY</span><span class="s2">&quot;</span> --header <span class="s2">&quot;Accept: application/json&quot;</span> --header <span class="s2">&quot;Content-Type: application/json&quot;</span> -k -X POST https://127.0.0.1/warninglists/update
  <span class="c1"># Updating the notice listsâ€¦</span>
  <span class="c1">## $SUDO_WWW $CAKE Admin updateNoticeLists</span>
  curl --header <span class="s2">&quot;Authorization: </span><span class="nv">$AUTH_KEY</span><span class="s2">&quot;</span> --header <span class="s2">&quot;Accept: application/json&quot;</span> --header <span class="s2">&quot;Content-Type: application/json&quot;</span> -k -X POST https://127.0.0.1/noticelists/update
  <span class="c1"># Updating the object templatesâ€¦</span>
  <span class="c1">##$SUDO_WWW $CAKE Admin updateObjectTemplates</span>
  curl --header <span class="s2">&quot;Authorization: </span><span class="nv">$AUTH_KEY</span><span class="s2">&quot;</span> --header <span class="s2">&quot;Accept: application/json&quot;</span> --header <span class="s2">&quot;Content-Type: application/json&quot;</span> -k -X POST https://127.0.0.1/objectTemplates/update
<span class="o">}</span>
<span class="c1"># &lt;snippet-end 2_core-cake.sh&gt;</span>
</pre></div>

<div class="codehilite"><pre><span></span>sudo gsed -i -e <span class="s1">&#39;$i \sudo -u www bash /usr/local/www/MISP/app/Console/worker/start.sh &gt; /tmp/worker_start_rc.local.log\n&#39;</span> /etc/rc.local
sudo gsed -i -e <span class="s1">&#39;$i \sudo -u www /usr/local/www/MISP/venv/bin/misp-modules -l 127.0.0.1 -s &gt; /tmp/misp-modules_rc.local.log 2&gt; /dev/null &amp;\n&#39;</span> /etc/rc.local
</pre></div>

<h3 id="10-misp-modules">10/ MISP modules<a class="headerlink" href="#10-misp-modules" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span>sudo pkg install -y yara
sudo mkdir /usr/local/src
sudo chmod <span class="m">2775</span> /usr/local/src
sudo chown root:staff /usr/local/src
<span class="nb">cd</span> /usr/local/src/
git clone https://github.com/MISP/misp-modules.git
<span class="nb">cd</span> misp-modules
<span class="c1"># lief broken...</span>
sudo -H -u www <span class="si">${</span><span class="nv">PATH_TO_MISP</span><span class="si">}</span>/venv/bin/pip install maec python-magic
sudo -H -u www <span class="si">${</span><span class="nv">PATH_TO_MISP</span><span class="si">}</span>/venv/bin/pip install -I -r REQUIREMENTS
sudo -H -u www <span class="si">${</span><span class="nv">PATH_TO_MISP</span><span class="si">}</span>/venv/bin/pip install .
<span class="c1">##sudo pip-3.6 install git+https://github.com/kbandla/pydeep.git</span>

<span class="c1"># install STIX2.0 library to support STIX 2.0 export:</span>
sudo -H -u www <span class="si">${</span><span class="nv">PATH_TO_MISP</span><span class="si">}</span>/venv/bin/pip install stix2
</pre></div>

<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If you have installed the recommended Python 3 virtualenv to the recommended place of <strong>${PATH_TO_MISP}/venv</strong> set the following MISP configurable
<div class="codehilite"><pre><span></span>sudo -H -u www-data <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.python_bin&quot;</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">PATH_TO_MISP</span><span class="si">}</span><span class="s2">/venv/bin/python&quot;</span>
</pre></div>
or on CentOS
<div class="codehilite"><pre><span></span>sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>MISP.python_bin<span class="s2">&quot; &quot;</span><span class="si">${</span><span class="nv">PATH_TO_MISP</span><span class="si">}</span>/venv/bin/python<span class="s2">&quot;&quot;</span>
</pre></div></p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Make sure that the STIX libraries and GnuPG work as intended, if not, refer to the relevant sections in the install guide you are currently reading.</p>
</div>
<div class="admonition notice">
<p class="admonition-title">Notice</p>
<p>Now log in using the webinterface: http://misp/users/login<br />
The default user/pass = <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#97;&#100;&#109;&#105;&#110;&#64;&#97;&#100;&#109;&#105;&#110;&#46;&#116;&#101;&#115;&#116;">&#97;&#100;&#109;&#105;&#110;&#64;&#97;&#100;&#109;&#105;&#110;&#46;&#116;&#101;&#115;&#116;</a>/admin<br />
Using the server settings tool in the admin interface (Administration -&gt; Server Settings), set MISP up to your preference.<br />
It is especially vital that no critical issues remain!<br />
Don't forget to change the email, password and authentication key after installation.<br />
Once done, have a look at the diagnostics.</p>
</div>
<div class="admonition notice">
<p class="admonition-title">Notice</p>
<p>If any of the directories that MISP uses to store files is not writeable to the apache user, change the permissions<br />
you can do this by running the following commands:
<div class="codehilite"><pre><span></span>chmod -R <span class="m">750</span> <span class="si">${</span><span class="nv">PATH_TO_MISP</span><span class="si">}</span>/&lt;directory path with an indicated issue&gt;
<span class="c1"># /!\ Depending on your OS replace www-data with apache or www or whatever user is the web server user.</span>
chown -R www-data:www-data <span class="si">${</span><span class="nv">PATH_TO_MISP</span><span class="si">}</span>/&lt;directory path with an indicated issue&gt;
</pre></div></p>
</div>
<div class="admonition notice">
<p class="admonition-title">Notice</p>
<p>If anything goes wrong, make sure that you check MISP's logs for errors:
<div class="codehilite"><pre><span></span># ${PATH_TO_MISP}/app/tmp/logs/error.log
# ${PATH_TO_MISP}/app/tmp/logs/resque-worker-error.log
# ${PATH_TO_MISP}/app/tmp/logs/resque-scheduler-error.log
# ${PATH_TO_MISP}/app/tmp/logs/resque-2018-10-25.log //where the actual date is the current date
</pre></div></p>
</div>
<h3 id="recommended-actions">Recommended actions<a class="headerlink" href="#recommended-actions" title="Permanent link">&para;</a></h3>
<hr />
<ul>
<li>
<p>By default CakePHP exposes its name and version in email headers. Apply a patch to remove this behavior.</p>
</li>
<li>
<p>You should really harden your OS</p>
</li>
<li>You should really harden the configuration of Apache</li>
<li>You should really harden the configuration of MySQL</li>
<li>Keep your software up2date (MISP, CakePHP and everything else)</li>
<li>Log and audit</li>
</ul>
<h3 id="optional-features">Optional features<a class="headerlink" href="#optional-features" title="Permanent link">&para;</a></h3>
<hr />
<h4 id="misp-has-a-new-pubsub-feature-using-zeromq-to-enable-it-simply-run-the-following-command">MISP has a new pub/sub feature, using ZeroMQ. To enable it, simply run the following command<a class="headerlink" href="#misp-has-a-new-pubsub-feature-using-zeromq-to-enable-it-simply-run-the-following-command" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span>sudo pkg install -y libzmq4
sudo -H -u www <span class="si">${</span><span class="nv">PATH_TO_MISP</span><span class="si">}</span>/venv/bin/pip install pyzmq
</pre></div>

<h4 id="misp-dashboard-not-working">misp-dashboard  (NOT WORKING)<a class="headerlink" href="#misp-dashboard-not-working" title="Permanent link">&para;</a></h4>
<div class="admonition notice">
<p class="admonition-title">Notice</p>
<p>Enable ZeroMQ for misp-dashboard</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This is not working, still needs a working WSGI config.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The install_dependencies.sh script is for Linux ONLY. The following blurp will be a diff of a working OpenBSD version.</p>
</div>
<div class="codehilite"><pre><span></span>(DASHENV) fbsd# diff -u install_dependencies.sh install_dependencies_fbsd.sh
<span class="gh">diff --git a/install_dependencies.sh b/install_dependencies.sh</span>
<span class="gh">index ca10fc0..bd5d415 100755</span>
<span class="gd">--- a/install_dependencies.sh</span>
<span class="gi">+++ b/install_dependencies.sh</span>
<span class="gu">@@ -1,9 +1,9 @@</span>
<span class="gd">-#!/bin/bash</span>
<span class="gi">+#!/usr/local/bin/bash</span>

 set -e
 #set -x

<span class="gd">-sudo apt-get install python3-virtualenv virtualenv screen redis-server unzip -y</span>
<span class="gi">+pkg install -y unzip wget screen</span>

 if [ -z &quot;$VIRTUAL_ENV&quot; ]; then
     virtualenv -p python3 DASHENV
<span class="gu">@@ -25,8 +25,8 @@ if [ -e &quot;config/config.cfg&quot; ]; then</span>
 else
     cp -i config/config.cfg.default config/config.cfg
     echo &quot;Sanitizing MaxMindDB Path&quot;
<span class="gd">-    sed -i &quot;s|pathMaxMindDB=./data/GeoLite2-City/GeoLite2-City.mmdb|pathMaxMindDB=$PWD/data/GeoLite2-City/GeoLite2-City.mmdb|&quot; config/config.cfg</span>
<span class="gd">-    sed -i &quot;s|path_countrycode_to_coord_JSON=./data/country_code_lat_long.json|path_countrycode_to_coord_JSON=$PWD/data/country_code_lat_long.json|&quot; config/config.cfg</span>
<span class="gi">+    gsed -i &quot;s|pathMaxMindDB=./data/GeoLite2-City/GeoLite2-City.mmdb|pathMaxMindDB=$PWD/data/GeoLite2-City/GeoLite2-City.mmdb|&quot; config/config.cfg</span>
<span class="gi">+    gsed -i &quot;s|path_countrycode_to_coord_JSON=./data/country_code_lat_long.json|path_countrycode_to_coord_JSON=$PWD/data/country_code_lat_long.json|&quot; config/config.cfg</span>
 fi

 ## Web stuff
</pre></div>

<div class="codehilite"><pre><span></span>cd /usr/local/www
sudo mkdir misp-dashboard
sudo chown www:www misp-dashboard
sudo -u www git clone https://github.com/MISP/misp-dashboard.git
cd misp-dashboard
#/!\ Made on Linux, the next script will fail
#sudo /usr/local/www/misp-dashboard/install_dependencies.sh
sudo virtualenv -ppython3 /usr/local/www/misp-dashboard/DASHENV
sudo chown -R www DASHENV/
sudo -u www /usr/local/www/misp-dashboard/DASHENV/bin/pip install -U pip argparse redis zmq geoip2 flask phonenumbers pycountry

sudo gsed -i &quot;s/^host\ =\ localhost/host\ =\ 0.0.0.0/g&quot; /usr/local/www/misp-dashboard/config/config.cfg
sudo gsed -i -e &#39;$i \sudo -u www bash /usr/local/www/misp-dashboard/start_all.sh\n&#39; /etc/rc.local
#/!\ Add port 8001 as a listener
#sudo sed -i &#39;/Listen 80/a Listen 0.0.0.0:8001&#39; /etc/apache2/ports.conf
sudo pkg install -y ap24-py36-mod_wsgi

echo &quot;&lt;VirtualHost *:8001&gt;
    ServerAdmin admin@misp.local
    ServerName misp.local
    DocumentRoot /usr/local/www/misp-dashboard

    WSGIDaemonProcess misp-dashboard \
       user=misp group=misp \
       python-home=/usr/local/www/misp-dashboard/DASHENV \
       processes=1 \
       threads=15 \
       maximum-requests=5000 \
       listen-backlog=100 \
       queue-timeout=45 \
       socket-timeout=60 \
       connect-timeout=15 \
       request-timeout=60 \
       inactivity-timeout=0 \
       deadlock-timeout=60 \
       graceful-timeout=15 \
       eviction-timeout=0 \
       shutdown-timeout=5 \
       send-buffer-size=0 \
       receive-buffer-size=0 \
       header-buffer-size=0 \
       response-buffer-size=0 \
       server-metrics=Off
    WSGIScriptAlias / /usr/local/www/misp-dashboard/misp-dashboard.wsgi
    &lt;Directory /usr/local/www/misp-dashboard&gt;
        WSGIProcessGroup misp-dashboard
        WSGIApplicationGroup %{GLOBAL}
        Require all granted
    &lt;/Directory&gt;
    LogLevel info
    ErrorLog /usr/local/log/apache2/misp-dashboard.local_error.log
    CustomLog /usr/local/log/apache2/misp-dashboard.local_access.log combined
    ServerSignature Off
&lt;/VirtualHost&gt;&quot; | sudo tee /usr/local/etc/apache24/sites-available/misp-dashboard.conf

sudo ln -s /usr/local/etc/apache24/sites-available/misp-dashboard.conf /usr/local/etc/apache24/sites-enabled/misp-dashboard.conf
</pre></div>

<p>Add this to /etc/httpd2.conf
<div class="codehilite"><pre><span></span>LoadModule wsgi_module /usr/local/lib/apache2/mod_wsgi.so
Listen 8001
</pre></div></p>
<div class="admonition notice">
<p class="admonition-title">Notice</p>
<p>If you want to add the misp modules functionality, follow the setup procedure described in misp-modules:<br />
<a href="https://github.com/MISP/misp-modules#how-to-install-and-start-misp-modules">https://github.com/MISP/misp-modules#how-to-install-and-start-misp-modules</a><br />
Then the enrichment, export and import modules can be enabled in MISP via the settings.</p>
</div>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../INSTALL.ubuntu1604/" title="Ubuntu 16.04" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Ubuntu 16.04
              </span>
            </div>
          </a>
        
        
          <a href="../../Changelog/" title="MISP Release Notes" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                MISP Release Notes
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2019 MISP Project
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="https://www.misp-project.org/" class="md-footer-social__link fa fa-globe"></a>
    
      <a href="https://github.com/MISP" class="md-footer-social__link fa fa-github-alt"></a>
    
      <a href="https://twitter.com/MISPProject" class="md-footer-social__link fa fa-twitter"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.b806dc00.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
  </body>
</html>