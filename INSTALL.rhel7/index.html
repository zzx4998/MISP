



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="MISP Project - Install Guides">
      
      
        <link rel="canonical" href="https://www.misp-project.org/INSTALL.rhel7/">
      
      
        <meta name="author" content="MISP Project">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.0.1">
    
    
      
        <title>Redhat Enterprise Linux 7 - MISP Install Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.982221ab.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.1f0bcf2b.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#installation-instructions-for-rhel-7x" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://www.misp-project.org/" title="MISP Install Documentation" class="md-header-nav__button md-logo">
          
            <img src="../img/misp.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              MISP Install Documentation
            </span>
            <span class="md-header-nav__topic">
              Redhat Enterprise Linux 7
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/MISP/MISP" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    MISP/MISP
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://www.misp-project.org/" title="MISP Install Documentation" class="md-nav__button md-logo">
      
        <img src="../img/misp.png" width="48" height="48">
      
    </a>
    MISP Install Documentation
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/MISP/MISP" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    MISP/MISP
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Install Guides
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Install Guides
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../INSTALL.ubuntu1804/" title="Ubuntu 18.04" class="md-nav__link">
      Ubuntu 18.04
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../INSTALL.kali/" title="Kali Linux" class="md-nav__link">
      Kali Linux
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Redhat Enterprise Linux 7
      </label>
    
    <a href="./" title="Redhat Enterprise Linux 7" class="md-nav__link md-nav__link--active">
      Redhat Enterprise Linux 7
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#0-overview-and-assumptions" title="0/ Overview and Assumptions" class="md-nav__link">
    0/ Overview and Assumptions
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#01-a-valid-support-agreement-allowing-the-system-to-register-to-the-red-hat-customer-portal-and-receive-updates" title="0.1/ A valid support agreement allowing the system to register to the Red Hat Customer Portal and receive updates" class="md-nav__link">
    0.1/ A valid support agreement allowing the system to register to the Red Hat Customer Portal and receive updates
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#02-the-ability-to-enable-additional-rpm-repositories-specifically-the-epel-and-software-collections-scl-repos" title="0.2/ The ability to enable additional RPM repositories, specifically the EPEL and Software Collections (SCL) repos" class="md-nav__link">
    0.2/ The ability to enable additional RPM repositories, specifically the EPEL and Software Collections (SCL) repos
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#03-this-system-will-have-direct-or-proxy-access-to-the-internet-for-updates-or-connected-to-a-red-hat-satellite-server" title="0.3/ This system will have direct or proxy access to the Internet for updates. Or connected to a Red Hat Satellite Server" class="md-nav__link">
    0.3/ This system will have direct or proxy access to the Internet for updates. Or connected to a Red Hat Satellite Server
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#04-this-document-is-to-get-a-misp-instance-up-and-running-over-http-i-havent-done-a-full-test-of-all-features" title="0.4/ This document is to get a MISP instance up and running over HTTP. I haven't done a full test of all features" class="md-nav__link">
    0.4/ This document is to get a MISP instance up and running over HTTP. I haven't done a full test of all features
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      xInstall Guides
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        xInstall Guides
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../xINSTALL/" title="Warning" class="md-nav__link">
      Warning
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../xINSTALL.centos6/" title="Centos 6" class="md-nav__link">
      Centos 6
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../xINSTALL.centos7/" title="Centos 7" class="md-nav__link">
      Centos 7
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../xINSTALL.debian9/" title="Debian stable" class="md-nav__link">
      Debian stable
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../xINSTALL.debian_testing/" title="Debian testing" class="md-nav__link">
      Debian testing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../xINSTALL.debian9-postgresql/" title="Debian 9 \w postgresql" class="md-nav__link">
      Debian 9 \w postgresql
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../xINSTALL.ubuntu1804.with.webmin/" title="Ubuntu 18.04 \w webmin" class="md-nav__link">
      Ubuntu 18.04 \w webmin
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../xINSTALL.tsurugi/" title="Tsurugi Linux" class="md-nav__link">
      Tsurugi Linux
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../xINSTALL.OpenBSD/" title="OpenBSD 6.4" class="md-nav__link">
      OpenBSD 6.4
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../xINSTALL.rhel7/" title="Redhat Enterprise Linux 7.6 (BETA)" class="md-nav__link">
      Redhat Enterprise Linux 7.6 (BETA)
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Config Guides
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Config Guides
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../CONFIG.elasticsearch-logging/" title="Elastic Search Logging" class="md-nav__link">
      Elastic Search Logging
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../CONFIG.s3-attachments/" title="Amazon S3 attachments" class="md-nav__link">
      Amazon S3 attachments
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../CONFIG.SMIME/" title="S/MIME" class="md-nav__link">
      S/MIME
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../UPDATE/" title="Update MISP" class="md-nav__link">
      Update MISP
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../UPGRADE/" title="Upgrading MISP" class="md-nav__link">
      Upgrading MISP
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Old guides
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Old guides
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../archive/old-2_3to2_4-UPGRADE/" title="2.3 to 2.4 upgrade" class="md-nav__link">
      2.3 to 2.4 upgrade
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../archive/INSTALL.ubuntu1604/" title="Ubuntu 16.04" class="md-nav__link">
      Ubuntu 16.04
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../archive/xINSTALL.FreeBSD/" title="FreeBSD" class="md-nav__link">
      FreeBSD
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      About
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        About
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Changelog/" title="MISP Release Notes" class="md-nav__link">
      MISP Release Notes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../license/" title="License" class="md-nav__link">
      License
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#0-overview-and-assumptions" title="0/ Overview and Assumptions" class="md-nav__link">
    0/ Overview and Assumptions
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#01-a-valid-support-agreement-allowing-the-system-to-register-to-the-red-hat-customer-portal-and-receive-updates" title="0.1/ A valid support agreement allowing the system to register to the Red Hat Customer Portal and receive updates" class="md-nav__link">
    0.1/ A valid support agreement allowing the system to register to the Red Hat Customer Portal and receive updates
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#02-the-ability-to-enable-additional-rpm-repositories-specifically-the-epel-and-software-collections-scl-repos" title="0.2/ The ability to enable additional RPM repositories, specifically the EPEL and Software Collections (SCL) repos" class="md-nav__link">
    0.2/ The ability to enable additional RPM repositories, specifically the EPEL and Software Collections (SCL) repos
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#03-this-system-will-have-direct-or-proxy-access-to-the-internet-for-updates-or-connected-to-a-red-hat-satellite-server" title="0.3/ This system will have direct or proxy access to the Internet for updates. Or connected to a Red Hat Satellite Server" class="md-nav__link">
    0.3/ This system will have direct or proxy access to the Internet for updates. Or connected to a Red Hat Satellite Server
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#04-this-document-is-to-get-a-misp-instance-up-and-running-over-http-i-havent-done-a-full-test-of-all-features" title="0.4/ This document is to get a MISP instance up and running over HTTP. I haven't done a full test of all features" class="md-nav__link">
    0.4/ This document is to get a MISP instance up and running over HTTP. I haven't done a full test of all features
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="installation-instructions-for-rhel-7x">INSTALLATION INSTRUCTIONS for RHEL 7.x<a class="headerlink" href="#installation-instructions-for-rhel-7x" title="Permanent link">&para;</a></h1>
<hr />
<h2 id="0-overview-and-assumptions">0/ Overview and Assumptions<a class="headerlink" href="#0-overview-and-assumptions" title="Permanent link">&para;</a></h2>
<div class="admonition notice">
<p class="admonition-title">Notice</p>
<p>There are technically only minor differences between CentOS and RHEL.<br />
For more information on what might differ, <a href="https://unix.stackexchange.com/questions/27323/is-centos-exactly-the-same-as-rhel">this StackExchange</a> question might answer some questions.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The core MISP team cannot verify if this guide is working or not. Please help us in keeping it up to date and accurate.
Thus we also have difficulties in supporting RHEL issues but will do a best effort on a similar yet slightly different setup.</p>
</div>
<p>This document details the steps to install MISP on Red Hat Enterprise Linux 7.x (RHEL 7.x). At time of this writing it
was tested on version 7.6.</p>
<p>The following assumptions with regard to this installation have been made.</p>
<h3 id="01-a-valid-support-agreement-allowing-the-system-to-register-to-the-red-hat-customer-portal-and-receive-updates">0.1/ A valid support agreement allowing the system to register to the Red Hat Customer Portal and receive updates<a class="headerlink" href="#01-a-valid-support-agreement-allowing-the-system-to-register-to-the-red-hat-customer-portal-and-receive-updates" title="Permanent link">&para;</a></h3>
<h3 id="02-the-ability-to-enable-additional-rpm-repositories-specifically-the-epel-and-software-collections-scl-repos">0.2/ The ability to enable additional RPM repositories, specifically the EPEL and Software Collections (SCL) repos<a class="headerlink" href="#02-the-ability-to-enable-additional-rpm-repositories-specifically-the-epel-and-software-collections-scl-repos" title="Permanent link">&para;</a></h3>
<h3 id="03-this-system-will-have-direct-or-proxy-access-to-the-internet-for-updates-or-connected-to-a-red-hat-satellite-server">0.3/ This system will have direct or proxy access to the Internet for updates. Or connected to a Red Hat Satellite Server<a class="headerlink" href="#03-this-system-will-have-direct-or-proxy-access-to-the-internet-for-updates-or-connected-to-a-red-hat-satellite-server" title="Permanent link">&para;</a></h3>
<h3 id="04-this-document-is-to-get-a-misp-instance-up-and-running-over-http-i-havent-done-a-full-test-of-all-features">0.4/ This document is to get a MISP instance up and running over HTTP. I haven't done a full test of all features<a class="headerlink" href="#04-this-document-is-to-get-a-misp-instance-up-and-running-over-http-i-havent-done-a-full-test-of-all-features" title="Permanent link">&para;</a></h3>
<h1 id="1-os-install-and-additional-repositories">1/ OS Install and additional repositories<a class="headerlink" href="#1-os-install-and-additional-repositories" title="Permanent link">&para;</a></h1>
<h2 id="11-complete-a-minimal-rhel-installation-configure-ip-address-to-connect-automatically">1.1/ Complete a minimal RHEL installation, configure IP address to connect automatically.<a class="headerlink" href="#11-complete-a-minimal-rhel-installation-configure-ip-address-to-connect-automatically" title="Permanent link">&para;</a></h2>
<h2 id="12-configure-system-hostname">1.2/ Configure system hostname<a class="headerlink" href="#12-configure-system-hostname" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span>sudo hostnamectl set-hostname misp <span class="c1"># Your choice, in a production environment, it&#39;s best to use a FQDN</span>
</pre></div>

<h2 id="13-register-the-system-for-updates-with-red-hat-subscription-manager">1.3/ Register the system for updates with Red Hat Subscription Manager<a class="headerlink" href="#13-register-the-system-for-updates-with-red-hat-subscription-manager" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span>sudo subscription-manager register --auto-attach <span class="c1"># register your system to an account and attach to a current subscription</span>
</pre></div>

<h2 id="14-enable-the-optional-extras-and-software-collections-scl-repos">1.4/ Enable the optional, extras and Software Collections (SCL) repos<a class="headerlink" href="#14-enable-the-optional-extras-and-software-collections-scl-repos" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span>sudo subscription-manager refresh 
sudo subscription-manager repos --enable rhel-7-server-optional-rpms
sudo subscription-manager repos --enable rhel-7-server-extras-rpms
sudo subscription-manager repos --enable rhel-server-rhscl-7-rpms
</pre></div>

<h3 id="15a-optional-install-the-deltarpm-package-to-help-reduce-download-size-when-installing-updates">1.5a/ OPTIONAL: Install the deltarpm package to help reduce download size when installing updates<a class="headerlink" href="#15a-optional-install-the-deltarpm-package-to-help-reduce-download-size-when-installing-updates" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span>sudo yum install deltarpm -y
</pre></div>

<h2 id="15-update-the-system-and-reboot">1.5/ Update the system and reboot<a class="headerlink" href="#15-update-the-system-and-reboot" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span>yum update -y
</pre></div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As time of writing performing a yum update results in the rhel-7-server-rt-beta-rpms being forbidden.<br />
The repo can be disabled using the following command
<div class="codehilite"><pre><span></span>subscription-manager repos --disable rhel-7-server-rt-beta-rpms
</pre></div></p>
</div>
<h2 id="16-install-the-epel-repo">1.6/ Install the EPEL repo<a class="headerlink" href="#16-install-the-epel-repo" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span>yum install https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm -y
</pre></div>

<h1 id="2-install-dependencies">2/ Install Dependencies<a class="headerlink" href="#2-install-dependencies" title="Permanent link">&para;</a></h1>
<p>Once the system is installed and updated, the following steps can be performed as root</p>
<h2 id="201-install-some-base-system-dependencies">2.01/ Install some base system dependencies<a class="headerlink" href="#201-install-some-base-system-dependencies" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span>yum install gcc git httpd zip python-devel libxslt-devel zlib-devel python-pip ssdeep-devel
</pre></div>

<h2 id="202-install-mariadb-102-from-scl">2.02/ Install MariaDB 10.2 from SCL<a class="headerlink" href="#202-install-mariadb-102-from-scl" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span>yum install rh-mariadb102
</pre></div>

<h2 id="203-start-the-mariadb-service-and-enable-it-to-start-on-boot">2.03/ Start the MariaDB service and enable it to start on boot<a class="headerlink" href="#203-start-the-mariadb-service-and-enable-it-to-start-on-boot" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span>systemctl <span class="nb">enable</span> --now rh-mariadb102-mariadb.service
</pre></div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>MISP 2.4 requires PHP 5.6 as a minimum, so we need a higher version than base RHEL provides.<br />
This guide installs PHP 7.2 from SCL</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><a href="https://secure.php.net/supported-versions.php">PHP 5.6 and 7.0 aren't supported since December 2018</a>. Please update accordingly. In the future only PHP7 will be supported.</p>
</div>
<h2 id="204-install-php-72-from-scl">2.04/ Install PHP 7.2 from SCL<a class="headerlink" href="#204-install-php-72-from-scl" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span>yum install rh-php72 rh-php72-php-fpm rh-php72-php-devel rh-php72-php-mysqlnd rh-php72-php-mbstring rh-php72-php-xml rh-php72-php-bcmath rh-php72-php-opcache
</pre></div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If we want to use httpd from RHEL base we can use the rh-php72-php-fpm service instead</p>
</div>
<h2 id="205-start-the-php-fpm-service-and-enable-to-start-on-boot">2.05/ Start the PHP FPM service and enable to start on boot<a class="headerlink" href="#205-start-the-php-fpm-service-and-enable-to-start-on-boot" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span>systemctl <span class="nb">enable</span> --now rh-php72-php-fpm.service
</pre></div>

<h2 id="206-install-redis-32-from-scl">2.06/ Install redis 3.2 from SCL<a class="headerlink" href="#206-install-redis-32-from-scl" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span>yum install rh-redis32
</pre></div>

<h2 id="207-start-redis-service-and-enable-to-start-on-boot">2.07/ Start redis service and enable to start on boot<a class="headerlink" href="#207-start-redis-service-and-enable-to-start-on-boot" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span>systemctl <span class="nb">enable</span> --now rh-redis32-redis.service
</pre></div>

<h2 id="208-secure-the-mariadb-installation">2.08/ Secure the MariaDB installation<a class="headerlink" href="#208-secure-the-mariadb-installation" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span>scl <span class="nb">enable</span> rh-mariadb102 <span class="s1">&#39;mysql_secure_installation&#39;</span>
</pre></div>

<h2 id="209-update-the-php-extension-repository-and-install-required-package">2.09/ Update the PHP extension repository and install required package<a class="headerlink" href="#209-update-the-php-extension-repository-and-install-required-package" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span>scl <span class="nb">enable</span> rh-php72 rh-redis32 bash
pear channel-update pear.php.net
pear install Crypt_GPG
</pre></div>

<h2 id="210-install-haveged-and-enable-to-start-on-boot-to-provide-entropy-for-gpg">2.10/ Install haveged and enable to start on boot to provide entropy for GPG<a class="headerlink" href="#210-install-haveged-and-enable-to-start-on-boot-to-provide-entropy-for-gpg" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span>yum install haveged
systemctl <span class="nb">enable</span> --now haveged
</pre></div>

<h2 id="211-install-python-36-from-scl">2.11/ Install Python 3.6 from SCL<a class="headerlink" href="#211-install-python-36-from-scl" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span>yum install rh-python36
</pre></div>

<h1 id="3-misp-download">3/ MISP Download<a class="headerlink" href="#3-misp-download" title="Permanent link">&para;</a></h1>
<h2 id="301-download-misp-code-using-git-in-varwww-directory">3.01/ Download MISP code using git in /var/www/ directory<a class="headerlink" href="#301-download-misp-code-using-git-in-varwww-directory" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><span class="nb">cd</span> /var/www
git clone https://github.com/MISP/MISP.git
<span class="nb">cd</span> MISP
git checkout tags/<span class="k">$(</span>git describe --tags <span class="sb">`</span>git rev-list --tags --max-count<span class="o">=</span><span class="m">1</span><span class="sb">`</span><span class="k">)</span>
<span class="c1"># if the last shortcut doesn&#39;t work, specify the latest version manually</span>
<span class="c1"># example: git checkout tags/v2.4.XY</span>
<span class="c1"># the message regarding a &quot;detached HEAD state&quot; is expected behaviour</span>
<span class="c1"># (you only have to create a new branch, if you want to change stuff and do a pull request for example)</span>
git submodule update --init --recursive
<span class="c1"># Make git ignore filesystem permission differences for submodules</span>
git submodule foreach --recursive git config core.filemode <span class="nb">false</span>
</pre></div>

<h2 id="302-make-git-ignore-filesystem-permission-differences">3.02/ Make git ignore filesystem permission differences<a class="headerlink" href="#302-make-git-ignore-filesystem-permission-differences" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span>git config core.filemode <span class="nb">false</span>
</pre></div>

<h2 id="303-install-mitres-stix-stix2-and-their-dependencies-by-running-the-following-commands">3.03/ Install Mitre's STIX, STIX2 and their dependencies by running the following commands<a class="headerlink" href="#303-install-mitres-stix-stix2-and-their-dependencies-by-running-the-following-commands" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span>yum install python-six
<span class="nb">cd</span> /var/www/MISP/app/files/scripts
git clone https://github.com/CybOXProject/python-cybox.git
git clone https://github.com/STIXProject/python-stix.git
<span class="nb">cd</span> /var/www/MISP/app/files/scripts/python-cybox
git config core.filemode <span class="nb">false</span>
<span class="c1"># If your umask has been changed from the default, it is a good idea to reset it to 0022 before installing python modules</span>
<span class="nv">UMASK</span><span class="o">=</span><span class="k">$(</span><span class="nb">umask</span><span class="k">)</span>
<span class="nb">umask</span> <span class="m">0022</span>
scl <span class="nb">enable</span> rh-python36 <span class="s1">&#39;python3 setup.py install&#39;</span>
<span class="nb">cd</span> /var/www/MISP/app/files/scripts/python-stix
git config core.filemode <span class="nb">false</span>
scl <span class="nb">enable</span> rh-python36 <span class="s1">&#39;python3 setup.py install&#39;</span>
<span class="nb">cd</span> /var/www/MISP/cti-python-stix2
scl <span class="nb">enable</span> rh-python36 <span class="s1">&#39;python3 setup.py install&#39;</span>
</pre></div>

<h2 id="304-install-mixbox-to-accommodate-the-new-stix-dependencies">3.04/ Install mixbox to accommodate the new STIX dependencies<a class="headerlink" href="#304-install-mixbox-to-accommodate-the-new-stix-dependencies" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><span class="nb">cd</span> /var/www/MISP/app/files/scripts/
git clone https://github.com/CybOXProject/mixbox.git
<span class="nb">cd</span> /var/www/MISP/app/files/scripts/mixbox
git config core.filemode <span class="nb">false</span>
scl <span class="nb">enable</span> rh-python36 <span class="s1">&#39;python3 setup.py install&#39;</span>
<span class="nb">umask</span> <span class="nv">$UMASK</span>
</pre></div>

<h2 id="305-enable-python3-for-php-fpm">3.05/ Enable python3 for php-fpm<a class="headerlink" href="#305-enable-python3-for-php-fpm" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><span class="nb">echo</span> <span class="s1">&#39;source scl_source enable rh-python36&#39;</span> &gt;&gt; /etc/opt/rh/rh-php72/sysconfig/php-fpm
sed -i.org -e <span class="s1">&#39;s/^;\(clear_env = no\)/\1/&#39;</span> /etc/opt/rh/rh-php72/php-fpm.d/www.conf
systemctl restart rh-php72-php-fpm.service
</pre></div>

<h2 id="306-enable-dependencies-detection-in-the-diagnostics-page">3.06/ Enable dependencies detection in the diagnostics page<a class="headerlink" href="#306-enable-dependencies-detection-in-the-diagnostics-page" title="Permanent link">&para;</a></h2>
<p>Add the following content to <code>/etc/opt/rh/rh-php72/php-fpm.d/www.conf</code> :
<div class="codehilite"><pre><span></span>env[PATH] =/opt/rh/rh-redis32/root/usr/bin:/opt/rh/rh-python36/root/usr/bin:/opt/rh/rh-php72/root/usr/bin:/usr/local/bin:/usr/bin:/bin
</pre></div>
Then run <code>systemctl restart rh-php72-php-fpm.service</code>.
This allows MISP to detect GnuPG, the Python modules' versions and to read the PHP settings.</p>
<h1 id="4-cakephp">4/ CakePHP<a class="headerlink" href="#4-cakephp" title="Permanent link">&para;</a></h1>
<h2 id="401-install-cakeresque-along-with-its-dependencies-if-you-intend-to-use-the-built-in-background-jobs">4.01/ Install CakeResque along with its dependencies if you intend to use the built in background jobs<a class="headerlink" href="#401-install-cakeresque-along-with-its-dependencies-if-you-intend-to-use-the-built-in-background-jobs" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><span class="nb">cd</span> /var/www/MISP/app
php composer.phar require kamisama/cake-resque:4.1.2
php composer.phar config vendor-dir Vendor
php composer.phar install
</pre></div>

<h2 id="402-install-and-configure-php-redis-connector-through-pecl">4.02/ Install and configure php redis connector through pecl<a class="headerlink" href="#402-install-and-configure-php-redis-connector-through-pecl" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span>scl <span class="nb">enable</span> rh-php72 <span class="s1">&#39;pecl install redis&#39;</span>
<span class="nb">echo</span> <span class="s2">&quot;extension=redis.so&quot;</span> &gt; /etc/opt/rh/rh-php72/php-fpm.d/redis.ini
ln -s /etc/opt/rh/rh-php72/php-fpm.d/redis.ini /etc/opt/rh/rh-php72/php.d/99-redis.ini
systemctl restart rh-php72-php-fpm.service
</pre></div>

<h2 id="403-set-a-timezone-in-phpini">4.03/ Set a timezone in php.ini<a class="headerlink" href="#403-set-a-timezone-in-phpini" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><span class="nb">echo</span> <span class="s1">&#39;date.timezone = &quot;Australia/Sydney&quot;&#39;</span> &gt; /etc/opt/rh/rh-php72/php-fpm.d/timezone.ini
ln -s /etc/opt/rh/rh-php72/php-fpm.d/timezone.ini /etc/opt/rh/rh-php72/php.d/99-timezone.ini
</pre></div>

<h2 id="404-to-use-the-scheduler-worker-for-scheduled-tasks-do-the-following">4.04/ To use the scheduler worker for scheduled tasks, do the following:<a class="headerlink" href="#404-to-use-the-scheduler-worker-for-scheduled-tasks-do-the-following" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span>cp -fa /var/www/MISP/INSTALL/setup/config.php /var/www/MISP/app/Plugin/CakeResque/Config/config.php
</pre></div>

<h2 id="405-install-crypt_gpg-and-console_commandline">4.05/ Install Crypt_GPG and Console_CommandLine<a class="headerlink" href="#405-install-crypt_gpg-and-console_commandline" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span>sudo -H -u apache scl <span class="nb">enable</span> rh-php72 <span class="s1">&#39;pear install ${PATH_TO_MISP}/INSTALL/dependencies/Console_CommandLine/package.xml&#39;</span>
sudo -H -u apache scl <span class="nb">enable</span> rh-php72 <span class="s1">&#39;pear install ${PATH_TO_MISP}/INSTALL/dependencies/Crypt_GPG/package.xml&#39;</span>
</pre></div>

<h1 id="5-set-file-permissions">5/ Set file permissions<a class="headerlink" href="#5-set-file-permissions" title="Permanent link">&para;</a></h1>
<p><div class="codehilite"><pre><span></span>chown -R apache:apache /var/www/MISP
find /var/www/MISP -type d -exec chmod <span class="nv">g</span><span class="o">=</span>rx <span class="o">{}</span> <span class="se">\;</span>
chmod -R g+r,o<span class="o">=</span> /var/www/MISP
</pre></div>
<strong>Note :</strong> For updates through the web interface to work, apache must own the /var/www/MISP folder and its subfolders as shown above, which can lead to security issues. If you do not require updates through the web interface to work, you can use the following more restrictive permissions :
<div class="codehilite"><pre><span></span>chown -R root:apache /var/www/MISP
find /var/www/MISP -type d -exec chmod <span class="nv">g</span><span class="o">=</span>rx <span class="o">{}</span> <span class="se">\;</span>
chmod -R g+r,o<span class="o">=</span> /var/www/MISP
chown apache:apache /var/www/MISP/app/files
chown apache:apache /var/www/MISP/app/files/terms
chown apache:apache /var/www/MISP/app/files/scripts/tmp
chown apache:apache /var/www/MISP/app/Plugin/CakeResque/tmp
chown -R apache:apache /var/www/MISP/app/tmp
chown -R apache:apache /var/www/MISP/app/webroot/img/orgs
chown -R apache:apache /var/www/MISP/app/webroot/img/custom
</pre></div></p>
<h1 id="6-create-database-and-user">6/ Create database and user<a class="headerlink" href="#6-create-database-and-user" title="Permanent link">&para;</a></h1>
<h2 id="601-set-database-to-listen-on-localhost-only">6.01/ Set database to listen on localhost only<a class="headerlink" href="#601-set-database-to-listen-on-localhost-only" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><span class="nb">echo</span> <span class="o">[</span>mysqld<span class="o">]</span> &gt; /etc/opt/rh/rh-mariadb102/my.cnf.d/bind-address.cnf
<span class="nb">echo</span> bind-address<span class="o">=</span><span class="m">127</span>.0.0.1 &gt;&gt; /etc/opt/rh/rh-mariadb102/my.cnf.d/bind-address.cnf
systemctl restart rh-mariadb102-mariadb
</pre></div>

<h2 id="602-start-a-mariadb-shell-and-create-the-database">6.02/ Start a MariaDB shell and create the database<a class="headerlink" href="#602-start-a-mariadb-shell-and-create-the-database" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span>scl <span class="nb">enable</span> rh-mariadb102 <span class="s1">&#39;mysql -u root -p&#39;</span>
</pre></div>

<div class="codehilite"><pre><span></span>MariaDB [(none)]&gt; create database misp;
MariaDB [(none)]&gt; grant usage on *.* to misp@localhost identified by &#39;XXXXXXXXX&#39;;
MariaDB [(none)]&gt; grant all privileges on misp.* to misp@localhost ;
MariaDB [(none)]&gt; exit
</pre></div>

<h2 id="603-import-the-empty-mysql-database-from-mysqlsql">6.03/ Import the empty MySQL database from MYSQL.sql<a class="headerlink" href="#603-import-the-empty-mysql-database-from-mysqlsql" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><span class="nb">cd</span> /var/www/MISP
mysql -u misp -p misp &lt; INSTALL/MYSQL.sql
</pre></div>

<h1 id="7-apache-configuration">7/ Apache Configuration<a class="headerlink" href="#7-apache-configuration" title="Permanent link">&para;</a></h1>
<h2 id="701-copy-a-sample-vhost-config-to-apache-configuration-directory">7.01/ Copy a sample vhost config to Apache configuration directory<a class="headerlink" href="#701-copy-a-sample-vhost-config-to-apache-configuration-directory" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span>cp /var/www/MISP/INSTALL/apache.misp.centos7 /etc/httpd/conf.d/misp.conf
</pre></div>

<h2 id="702-since-selinux-is-enabled-we-need-to-allow-httpd-to-write-to-certain-directories">7.02/ Since SELinux is enabled, we need to allow httpd to write to certain directories<a class="headerlink" href="#702-since-selinux-is-enabled-we-need-to-allow-httpd-to-write-to-certain-directories" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span>chcon -t httpd_sys_rw_content_t /var/www/MISP/app/files
chcon -t httpd_sys_rw_content_t /var/www/MISP/app/files/terms
chcon -t httpd_sys_rw_content_t /var/www/MISP/app/files/scripts/tmp
chcon -t httpd_sys_rw_content_t /var/www/MISP/app/Plugin/CakeResque/tmp
chcon -R -t httpd_sys_rw_content_t /var/www/MISP/app/tmp
chcon -R -t httpd_sys_rw_content_t /var/www/MISP/app/webroot/img/orgs
chcon -R -t httpd_sys_rw_content_t /var/www/MISP/app/webroot/img/custom
</pre></div>

<h2 id="703-allow-httpd-to-connect-to-the-redis-server-and-php-fpm-over-tcpip">7.03/ Allow httpd to connect to the redis server and php-fpm over tcp/ip<a class="headerlink" href="#703-allow-httpd-to-connect-to-the-redis-server-and-php-fpm-over-tcpip" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span>setsebool -P httpd_can_network_connect on
</pre></div>

<h2 id="704-enable-and-start-the-httpd-service">7.04/ Enable and start the httpd service<a class="headerlink" href="#704-enable-and-start-the-httpd-service" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span>systemctl <span class="nb">enable</span> --now httpd.service
</pre></div>

<h2 id="705-open-a-hole-in-the-firewalld-service">7.05/ Open a hole in the firewalld service<a class="headerlink" href="#705-open-a-hole-in-the-firewalld-service" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span>firewall-cmd --zone<span class="o">=</span>public --add-port<span class="o">=</span><span class="m">80</span>/tcp --permanent
firewall-cmd --reload
</pre></div>

<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>We seriously recommend using only HTTPS / SSL !
Add SSL support by running: yum install mod_ssl
Check out the apache.misp.ssl file for an example</p>
</div>
<h1 id="8-log-rotation">8/ Log Rotation<a class="headerlink" href="#8-log-rotation" title="Permanent link">&para;</a></h1>
<h2 id="801-enable-log-rotation">8.01/ Enable log rotation<a class="headerlink" href="#801-enable-log-rotation" title="Permanent link">&para;</a></h2>
<p>MISP saves the stdout and stderr of it's workers in /var/www/MISP/app/tmp/logs
To rotate these logs install the supplied logrotate script:
<div class="codehilite"><pre><span></span>cp INSTALL/misp.logrotate /etc/logrotate.d/misp
chmod 0640 /etc/logrotate.d/misp
</pre></div></p>
<h2 id="802-allow-logrotate-to-work-under-selinux-and-modify-the-log-files">8.02/ Allow logrotate to work under SELinux and modify the log files<a class="headerlink" href="#802-allow-logrotate-to-work-under-selinux-and-modify-the-log-files" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span>semanage fcontext -a -t httpd_log_t <span class="s2">&quot;/var/www/MISP/app/tmp/logs(/.*)?&quot;</span>
chcon -R -t httpd_log_t /var/www/MISP/app/tmp/logs
</pre></div>

<h2 id="803-allow-logrotate-to-read-varwww">8.03/ Allow logrotate to read /var/www<a class="headerlink" href="#803-allow-logrotate-to-read-varwww" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span>checkmodule -M -m -o /tmp/misplogrotate.mod INSTALL/misplogrotate.te
semodule_package -o /tmp/misplogrotate.pp -m /tmp/misplogrotate.mod
semodule -i /tmp/misplogrotate.pp
</pre></div>

<h1 id="9-misp-configuration">9/ MISP Configuration<a class="headerlink" href="#9-misp-configuration" title="Permanent link">&para;</a></h1>
<h2 id="901-there-are-4-sample-configuration-files-in-varwwwmispappconfig-that-need-to-be-copied">9.01/ There are 4 sample configuration files in /var/www/MISP/app/Config that need to be copied<a class="headerlink" href="#901-there-are-4-sample-configuration-files-in-varwwwmispappconfig-that-need-to-be-copied" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><span class="nb">cd</span> /var/www/MISP/app/Config
cp -a bootstrap.default.php bootstrap.php
cp -a database.default.php database.php
cp -a core.default.php core.php
cp -a config.default.php config.php
</pre></div>

<h2 id="902-configure-the-fields-in-the-newly-created-files">9.02/ Configure the fields in the newly created files<a class="headerlink" href="#902-configure-the-fields-in-the-newly-created-files" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><span class="c1"># Configure the fields in the newly created files:</span>
<span class="c1"># config.php   : baseurl (example: &#39;baseurl&#39; =&gt; &#39;http://misp&#39;,) - don&#39;t use &quot;localhost&quot; it causes issues when browsing externally</span>
<span class="c1"># core.php   : Uncomment and set the timezone: `// date_default_timezone_set(&#39;UTC&#39;);`</span>
<span class="c1"># database.php : login, port, password, database</span>
<span class="c1"># DATABASE_CONFIG has to be filled</span>
<span class="c1"># With the default values provided in section 6, this would look like:</span>
<span class="c1"># class DATABASE_CONFIG {</span>
<span class="c1">#   public $default = array(</span>
<span class="c1">#       &#39;datasource&#39; =&gt; &#39;Database/Mysql&#39;,</span>
<span class="c1">#       &#39;persistent&#39; =&gt; false,</span>
<span class="c1">#       &#39;host&#39; =&gt; &#39;localhost&#39;,</span>
<span class="c1">#       &#39;login&#39; =&gt; &#39;misp&#39;, // grant usage on *.* to misp@localhost</span>
<span class="c1">#       &#39;port&#39; =&gt; 3306,</span>
<span class="c1">#       &#39;password&#39; =&gt; &#39;XXXXdbpasswordhereXXXXX&#39;, // identified by &#39;XXXXdbpasswordhereXXXXX&#39;;</span>
<span class="c1">#       &#39;database&#39; =&gt; &#39;misp&#39;, // create database misp;</span>
<span class="c1">#       &#39;prefix&#39; =&gt; &#39;&#39;,</span>
<span class="c1">#       &#39;encoding&#39; =&gt; &#39;utf8&#39;,</span>
<span class="c1">#   );</span>
<span class="c1">#}</span>

<span class="c1"># Important! Change the salt key in /var/www/MISP/app/Config/config.php</span>
<span class="c1"># The admin user account will be generated on the first login, make sure that the salt is changed before you create that user</span>
<span class="c1"># If you forget to do this step, and you are still dealing with a fresh installation, just alter the salt,</span>
<span class="c1"># delete the user from mysql and log in again using the default admin credentials (admin@admin.test / admin)</span>
</pre></div>

<h2 id="903-if-you-want-to-be-able-to-change-configuration-parameters-from-the-webinterface">9.03/ If you want to be able to change configuration parameters from the webinterface:<a class="headerlink" href="#903-if-you-want-to-be-able-to-change-configuration-parameters-from-the-webinterface" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span>chown apache:apache /var/www/MISP/app/Config/config.php
chcon -t httpd_sys_rw_content_t /var/www/MISP/app/Config/config.php
</pre></div>

<h2 id="904-generate-an-encryption-key">9.04/ Generate an encryption key<a class="headerlink" href="#904-generate-an-encryption-key" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span>gpg --gen-key
mv ~/.gnupg /var/www/MISP/
chown -R apache:apache /var/www/MISP/.gnupg
chcon -R -t httpd_sys_rw_content_t /var/www/MISP/.gnupg
</pre></div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There is a bug that if a passphrase is added MISP will produce an error on the diagnostic page.<br />
/! THIS WANTS TO BE VERIFIED AND LINKED WITH A CORRESPONDING ISSUE.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The email address should match the one set in the config.php configuration file
Make sure that you use the same settings in the MISP Server Settings tool</p>
</div>
<h2 id="905-export-the-public-key-to-the-webroot">9.05/ Export the public key to the webroot<a class="headerlink" href="#905-export-the-public-key-to-the-webroot" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span>sudo -u apache gpg --homedir /var/www/MISP/.gnupg --export --armor YOUR-EMAIL &gt; /var/www/MISP/app/webroot/gpg.asc
</pre></div>

<h2 id="906-use-misps-background-workers">9.06/ Use MISP's background workers<a class="headerlink" href="#906-use-misps-background-workers" title="Permanent link">&para;</a></h2>
<h3 id="906a-create-a-systemd-unit-for-the-workers">9.06a/ Create a systemd unit for the workers<a class="headerlink" href="#906a-create-a-systemd-unit-for-the-workers" title="Permanent link">&para;</a></h3>
<p>Create the following file :
<code>/etc/systemd/system/misp-workers.service</code>
<div class="codehilite"><pre><span></span>[Unit]
Description=MISP&#39;s background workers
After=rh-mariadb102-mariadb.service rh-redis32-redis.service rh-php72-php-fpm.service

[Service]
Type=forking
User=apache
Group=apache
ExecStart=/usr/bin/scl enable rh-php72 rh-redis32 rh-mariadb102 /var/www/MISP/app/Console/worker/start.sh
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
</pre></div>
Make the workers' script executable and reload the systemd units :
<div class="codehilite"><pre><span></span>chmod +x /var/www/MISP/app/Console/worker/start.sh
systemctl daemon-reload
</pre></div></p>
<h3 id="906b-start-the-workers-and-enable-them-on-boot">9.06b/ Start the workers and enable them on boot<a class="headerlink" href="#906b-start-the-workers-and-enable-them-on-boot" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span>systemctl <span class="nb">enable</span> --now misp-workers.service
</pre></div>

<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If you have installed the recommended Python 3 virtualenv to the recommended place of <strong>${PATH_TO_MISP}/venv</strong> set the following MISP configurable
<div class="codehilite"><pre><span></span>sudo -H -u www-data <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.python_bin&quot;</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">PATH_TO_MISP</span><span class="si">}</span><span class="s2">/venv/bin/python&quot;</span>
</pre></div>
or on CentOS
<div class="codehilite"><pre><span></span>sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>MISP.python_bin<span class="s2">&quot; &quot;</span><span class="si">${</span><span class="nv">PATH_TO_MISP</span><span class="si">}</span>/venv/bin/python<span class="s2">&quot;&quot;</span>
</pre></div></p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Make sure that the STIX libraries and GnuPG work as intended, if not, refer to the relevant sections in the install guide you are currently reading.</p>
</div>
<div class="admonition notice">
<p class="admonition-title">Notice</p>
<p>Now log in using the webinterface: http://misp/users/login<br />
The default user/pass = <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#97;&#100;&#109;&#105;&#110;&#64;&#97;&#100;&#109;&#105;&#110;&#46;&#116;&#101;&#115;&#116;">&#97;&#100;&#109;&#105;&#110;&#64;&#97;&#100;&#109;&#105;&#110;&#46;&#116;&#101;&#115;&#116;</a>/admin<br />
Using the server settings tool in the admin interface (Administration -&gt; Server Settings), set MISP up to your preference.<br />
It is especially vital that no critical issues remain!<br />
Don't forget to change the email, password and authentication key after installation.<br />
Once done, have a look at the diagnostics.</p>
</div>
<div class="admonition notice">
<p class="admonition-title">Notice</p>
<p>If any of the directories that MISP uses to store files is not writeable to the apache user, change the permissions<br />
you can do this by running the following commands:
<div class="codehilite"><pre><span></span>chmod -R <span class="m">750</span> <span class="si">${</span><span class="nv">PATH_TO_MISP</span><span class="si">}</span>/&lt;directory path with an indicated issue&gt;
<span class="c1"># /!\ Depending on your OS replace www-data with apache or www or whatever user is the web server user.</span>
chown -R www-data:www-data <span class="si">${</span><span class="nv">PATH_TO_MISP</span><span class="si">}</span>/&lt;directory path with an indicated issue&gt;
</pre></div></p>
</div>
<div class="admonition notice">
<p class="admonition-title">Notice</p>
<p>If anything goes wrong, make sure that you check MISP's logs for errors:
<div class="codehilite"><pre><span></span># ${PATH_TO_MISP}/app/tmp/logs/error.log
# ${PATH_TO_MISP}/app/tmp/logs/resque-worker-error.log
# ${PATH_TO_MISP}/app/tmp/logs/resque-scheduler-error.log
# ${PATH_TO_MISP}/app/tmp/logs/resque-2018-10-25.log //where the actual date is the current date
</pre></div></p>
</div>
<h3 id="recommended-actions">Recommended actions<a class="headerlink" href="#recommended-actions" title="Permanent link">&para;</a></h3>
<hr />
<ul>
<li>
<p>By default CakePHP exposes its name and version in email headers. Apply a patch to remove this behavior.</p>
</li>
<li>
<p>You should really harden your OS</p>
</li>
<li>You should really harden the configuration of Apache</li>
<li>You should really harden the configuration of MySQL</li>
<li>Keep your software up2date (MISP, CakePHP and everything else)</li>
<li>Log and audit</li>
</ul>
<h1 id="10-post-install">10/ Post Install<a class="headerlink" href="#10-post-install" title="Permanent link">&para;</a></h1>
<h2 id="1001-allow-apache-to-write-to-varwwwmispapptmplogs">10.01/ Allow apache to write to /var/www/MISP/app/tmp/logs<a class="headerlink" href="#1001-allow-apache-to-write-to-varwwwmispapptmplogs" title="Permanent link">&para;</a></h2>
<p>If the result from the diagnostic page is that the directory is not writable, try the following.
<div class="codehilite"><pre><span></span>chcon -R -t httpd_sys_rw_content_t /var/www/MISP/app/tmp/logs/
</pre></div></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This may mean that logrotate cannot access the logs directory, will require further investigation</p>
</div>
<h2 id="1002-change-phpini-settings-to-suggested-limits-from-diagnostic-page">10.02/ Change php.ini settings to suggested limits from diagnostic page.<a class="headerlink" href="#1002-change-phpini-settings-to-suggested-limits-from-diagnostic-page" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><span class="c1"># Edit /etc/opt/rh/rh-php72/php.ini and set the following settings</span>
<span class="nv">max_execution_time</span> <span class="o">=</span> <span class="m">300</span>
<span class="nv">memory_limit</span> <span class="o">=</span> 512M
<span class="nv">upload_max_filesize</span> <span class="o">=</span> 50M
<span class="nv">post_max_size</span> <span class="o">=</span> 50M
</pre></div>

<h2 id="1003-restart-rh-php72-for-settings-to-take-effect">10.03/ Restart rh-php72 for settings to take effect<a class="headerlink" href="#1003-restart-rh-php72-for-settings-to-take-effect" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span>systemctl restart rh-php72-php-fpm
</pre></div>

<h2 id="1004-install-pydeep-and-pymisp">10.04/ Install pydeep and pymisp<a class="headerlink" href="#1004-install-pydeep-and-pymisp" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span>scl <span class="nb">enable</span> rh-python36 <span class="s1">&#39;python3 -m pip install pymisp git+https://github.com/kbandla/pydeep.git&#39;</span>
</pre></div>

<h1 id="11-lief-installation">11/ LIEF Installation<a class="headerlink" href="#11-lief-installation" title="Permanent link">&para;</a></h1>
<p><em>lief</em> is required for the Advanced Attachment Handler and requires manual compilation</p>
<h2 id="1101-install-cmake3-devtoolset-7-from-scl">11.01/ Install cmake3 devtoolset-7 from SCL<a class="headerlink" href="#1101-install-cmake3-devtoolset-7-from-scl" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span>yum install devtoolset-7 cmake3
</pre></div>

<h2 id="1102-create-the-directory-and-download-the-source-code">11.02/ Create the directory and download the source code<a class="headerlink" href="#1102-create-the-directory-and-download-the-source-code" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><span class="nb">cd</span> /var/www/MISP/app/files/scripts
git clone --branch master --single-branch https://github.com/lief-project/LIEF.git lief
</pre></div>

<h2 id="1103-compile-lief-and-install-it">11.03/ Compile lief and install it<a class="headerlink" href="#1103-compile-lief-and-install-it" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><span class="nb">cd</span> /var/www/MISP/app/files/scripts/lief
mkdir build
<span class="nb">cd</span> build
scl <span class="nb">enable</span> devtoolset-7 rh-python36 <span class="s1">&#39;bash -c &quot;cmake3 \</span>
<span class="s1">-DLIEF_PYTHON_API=on \</span>
<span class="s1">-DLIEF_DOC=off \</span>
<span class="s1">-DCMAKE_INSTALL_PREFIX=$LIEF_INSTALL \</span>
<span class="s1">-DCMAKE_BUILD_TYPE=Release \</span>
<span class="s1">-DPYTHON_VERSION=3.6 \</span>
<span class="s1">..&quot;&#39;</span>
make -j3
<span class="nb">cd</span> api/python
scl <span class="nb">enable</span> rh-python36 <span class="s1">&#39;python3 setup.py install || :&#39;</span>
<span class="c1"># when running setup.py, pip will download and install remote LIEF packages that will prevent MISP from detecting the packages that you compiled ; remove them</span>
find /opt/rh/rh-python36/root/ -name <span class="s2">&quot;*lief*&quot;</span> -exec rm -rf <span class="o">{}</span> <span class="se">\;</span>
</pre></div>

<h2 id="1104-test-lief-installation-if-no-error-package-installed">11.04/ Test lief installation, if no error, package installed<a class="headerlink" href="#1104-test-lief-installation-if-no-error-package-installed" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span>scl <span class="nb">enable</span> rh-python36 python3
&gt;&gt; import lief
</pre></div>

<h1 id="12-known-issues">12/ Known Issues<a class="headerlink" href="#12-known-issues" title="Permanent link">&para;</a></h1>
<h2 id="1201-workers-cannot-be-started-or-restarted-from-the-web-page">12.01/ Workers cannot be started or restarted from the web page<a class="headerlink" href="#1201-workers-cannot-be-started-or-restarted-from-the-web-page" title="Permanent link">&para;</a></h2>
<p>Possible also due to package being installed via SCL, attempting to start workers through the web page will result in
error. Worker's can be restarted via the CLI using the following command.
<div class="codehilite"><pre><span></span>systemctl restart misp-workers.service
</pre></div></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>No other functions were tested after the conclusion of this install. There may be issue that aren't addressed<br />
via this guide and will need additional investigation.</p>
</div>
<h1 id="hardening-a-base-system">Hardening a base system<a class="headerlink" href="#hardening-a-base-system" title="Permanent link">&para;</a></h1>
<h2 id="intro">Intro<a class="headerlink" href="#intro" title="Permanent link">&para;</a></h2>
<p>MISP is a web-based <strong>information sharing platform</strong>, by design it is kept rather simple and hardening can be done by following the common best practices.</p>
<p>Bare in mind that neither the MISP documentation efforts or the core MISP project can give you the ultimate guide on how to harden your system.
This is not the purpose of the MISP Project but the purpose and care of those individuals and organizations deploying MISP Instances.</p>
<p>Nevertheless here is a very rough <strong>food for thoughts</strong> bulletpoint list for you to consider, and a list of some hardening ressources below.</p>
<ul>
<li>Are we using SSL by default? (Especially when syncing over the internet and exposing the API)</li>
<li>How to we access the machine remotely? Via ssh? What is the path to get there? Does a <a href="https://en.wikipedia.org/wiki/Bastion_host">bastion host</a> make sense?</li>
<li>Is the machine shared with other user accounts? Do I need to care about useri-land security due to this sharing?</li>
<li>Is the instance deployed in the "<strong>cloud</strong>"? Is it a VPS? AWS? docker? ansible? kubernetes? whateverCloudContainterMagicIsFancibleNow?</li>
<li>Do we need to encrypt the partitions where some data is stored?</li>
<li>Are we redundant in case one MISP instance might fail?</li>
<li>Is the database server and any other servers running on the machine bound to <strong>localhost</strong>? Do we need to expose because our setup is more complex?</li>
<li>Do we have enough storage? What about <a href="https://misp-project.org/MISP-sizer/">MISP and size estimation</a> anyways?</li>
<li>Do we care about BIOS updates?</li>
<li>Do we care about physical access to the servers? (Disabling USB ports etc...)</li>
<li>Is any fancy management engine  la <a href="https://en.wikipedia.org/wiki/Intel_Management_Engine">IME</a> in use?</li>
</ul>
<h2 id="apache">Apache<a class="headerlink" href="#apache" title="Permanent link">&para;</a></h2>
<p>To make Apache less verbose in terms of sending banners, the belo might help.</p>
<div class="codehilite"><pre><span></span>diff --git a/apache2/conf-available/security.conf b/apache2/conf-available/security.conf
index f9f69d4..2e8fd78 100644
--- a/apache2/conf-available/security.conf
+++ b/apache2/conf-available/security.conf
@@ -22,7 +22,7 @@
 # Set to one of:  Full | OS | Minimal | Minor | Major | Prod
 # where Full conveys the most information, and Prod the least.
 #ServerTokens Minimal
-ServerTokens OS
+ServerTokens Prod
 #ServerTokens Full

 #
@@ -33,7 +33,7 @@ ServerTokens OS
 # Set to &quot;EMail&quot; to also include a mailto: link to the ServerAdmin.
 # Set to one of:  On | Off | EMail
 #ServerSignature Off
-ServerSignature On
+ServerSignature Off

 #
 # Allow TRACE method
</pre></div>

<h2 id="resources">Resources<a class="headerlink" href="#resources" title="Permanent link">&para;</a></h2>
<p><a href="https://wiki.debian.org/Hardening">Debian Wiki Hardening</a></p>
<p><a href="https://wiki.centos.org/HowTos/OS_Protection">CentOS Hardening</a></p>
<p><a href="https://www.cyberciti.biz/tips/linux-security.html">Some Linux hardening tips</a></p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../INSTALL.kali/" title="Kali Linux" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Kali Linux
              </span>
            </div>
          </a>
        
        
          <a href="../xINSTALL/" title="Warning" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Warning
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2019 MISP Project
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../assets/fonts/font-awesome.css">
    
      <a href="https://www.misp-project.org/" class="md-footer-social__link fa fa-globe"></a>
    
      <a href="https://github.com/MISP" class="md-footer-social__link fa fa-github-alt"></a>
    
      <a href="https://twitter.com/MISPProject" class="md-footer-social__link fa fa-twitter"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.b806dc00.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>